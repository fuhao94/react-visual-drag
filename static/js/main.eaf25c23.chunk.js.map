{"version":3,"sources":["assets/cat.jpeg","core/data.ts","utils/translate.ts","utils/index.ts","core/BaseComponents.tsx","core/context/component-data.ts","core/context/context-menu.ts","utils/events.ts","core/Editor/Shape.tsx","hooks/use-previous.ts","core/Editor/Preview/Shape.tsx","core/Editor/Preview/index.tsx","core/Editor/Area.tsx","core/Editor/ContextMenu.tsx","core/Editor/Grid.tsx","core/Editor/MarkLine.tsx","core/Editor/index.tsx","core/Property/data.ts","core/Property/Event.tsx","core/Property/index.tsx","core/reducer/component-data.ts","core/reducer/context-menu.ts","core/Toolbar.tsx","Home/index.tsx","App.tsx","index.tsx"],"names":["commonStyle","rotate","opacity","top","left","COMPONENT_LIST","baseConfig","name","label","props","placeholder","style","width","height","borderWidth","borderColor","borderRadius","fontSize","fontWeight","lineHeight","letterSpacing","textAlign","color","backgroundColor","src","require","default","map","config","id","angleToRadian","angle","Math","PI","sin","abs","cos","generateID","$","selector","document","querySelector","transformStyle","reduce","prev","attr","transform","getComponentStyle","filter","needUnit","Object","keys","result","key","includes","getStyle","getPointStyle","point","hasT","test","hasB","hasL","hasR","newLeft","newTop","length","floor","marginLeft","marginTop","getComponentRotatedStyle","pos","Number","newWidth","diffX","right","newHeight","diffY","bottom","maps","BoldOutlined","FileTextOutlined","FileImageOutlined","getIcon","BaseComponents","onDragStart","e","dataTransfer","setData","target","dataset","index","span","marginBottom","icon","draggable","Context","createContext","componentDispatch","curComponentIndex","componentState","componentData","isClickComponent","preview","snapshots","snapshotIndex","curComponentId","dragShiftStyle","canvasStyle","menuDispatch","menuState","visible","position","events","redirect","url","window","location","href","message","msg","info","eventList","event","param","generateComponent","component","mode","onInputChange","onChange","value","alt","SHAPE_POINTS","Shape","prefixCls","originalComponent","onMove","onDestroyMove","useContext","ComponentDataContext","ContextMenuContext","preDragShiftStyle","ref","useRef","useEffect","current","usePrevious","useState","setComponent","editorRef","onSyncData","debounce","type","payload","onChangeShapeStyle","isEmpty","isEqual","merge","isNil","className","onClick","stopPropagation","preventDefault","onMouseDown","startY","clientY","startX","clientX","startTop","startLeft","move","moveEvent","currX","currY","addEventListener","up","removeEventListener","RedoOutlined","startRotate","rect","getBoundingClientRect","centerX","centerY","rotateDegreeBefore","atan2","curX","curY","rotateDegreeAfter","downEvent","disY","disX","onPointMouseDown","shapePointEl","defaultProps","curComponent","find","curComponentEvents","forEach","Preview","footer","closable","onCancel","Area","ContextMenu","visibility","onMouseUp","Grid","xmlns","background","patternUnits","d","fill","stroke","strokeWidth","LINES_MAP","INIT_LINE_STATUS","xt","xc","xb","yl","yc","yr","INIT_LINE_STYLE","decideIsNearly","dragValue","targetValue","MarkLine","forwardRef","lineStatus","setLineStatus","lineStyle","setLineStyle","showLine","curComponentStyle","curComponentHalfWidth","curComponentHalfHeight","curComponentWidth","curComponentHeight","curComponentLeft","curComponentRight","curComponentTop","curComponentBottom","componentStyle","componentHalfWidth","componentHalfHeight","conditions","line","isNearly","dragShift","lineShift","newLineStyle","newLineStatus","condition","lineItem","assign","onChooseTheTureLine","useImperativeHandle","hideLine","display","Editor","showArea","setShowArea","markLineRef","editorPosRef","editorX","editorY","startRef","x","y","area","setArea","areaRef","onShapeMove","onShapeDestroyMove","onCreateAreaGroup","areaComponents","aWidth","aHeight","push","getSelectedArea","Infinity","onContextMenu","nativeEvent","offsetY","offsetX","SVGElement","parentNode","offsetLeft","offsetTop","propertyConfigs","componentName","options","TabPane","Tabs","Event","setVisible","setValue","tab","setTab","placement","onClose","activeKey","eventItem","TextArea","success","FormItem","Form","Item","initialValues","undefined","letterSpace","propFields","renderFormItem","restProps","Property","initial","setInitial","useForm","form","firstRenderRef","reset","resetFields","setComponentContext","defaultActiveKey","forceRender","colon","labelCol","onValuesChange","changedValues","values","curStyle","omit","snapshot","names","join","title","needIndexTypes","replaceComponentsLocation","sourceComponents","source","components","reducer","state","action","findIndex","cloneDeep","newState","newComponents","curIndex","splice","newSnapshotIndex","copyData","data","error","slice","replaceEventIndex","Error","Toolbar","onReload","onCanvasStyleChange","size","min","max","defaultValue","Demo","useReducer","componentReducer","contextReducer","useMemo","Provider","onDrop","getData","onDragOver","dropEffect","setTimeout","button","App","ReactDOM","render","StrictMode","locale","zhCN","getElementById"],"mappings":"gOAAA,OAAe,cAA0B,kC,wMCG5BA,EAAc,CACzBC,OAAQ,EACRC,QAAS,EACTC,IAAK,EACLC,KAAM,GAGKC,EAAkB,WAC7B,IAAMC,EAAa,CACjB,CACEC,KAAM,UACNC,MAAO,eACPC,MAAO,CACLC,YAAa,sBAEfC,MAAO,CACLC,MAAO,IACPC,OAAQ,KAGZ,CACEN,KAAM,WACNC,MAAO,eACPC,MAAO,GACPE,MAAO,CACLC,MAAO,IACPC,OAAQ,GACRC,YAAa,EACbC,YAAa,GACbC,aAAc,GACdC,SAAU,GACVC,WAAY,IACZC,WAAY,GACZC,cAAe,EACfC,UAAW,GACXC,MAAO,GACPC,gBAAiB,KAGrB,CACEhB,KAAM,QACNC,MAAO,eACPC,MAAO,CACLe,IAAKC,EAAQ,KAAqBC,SAEpCf,MAAO,CACLC,MAAO,IACPC,OAAQ,OAKd,OAAOc,YAAIrB,GAAY,SAAAsB,GAAM,gCAE3BC,IAAK,GACFD,GAHwB,IAI3BjB,MAAM,2BAAMiB,EAAOjB,OAAUX,QAjDF,G,QCN/B,SAAS8B,EAAcC,GACrB,OAAQA,EAAQC,KAAKC,GAAM,IAGtB,SAASC,EAAIjC,GAClB,OAAO+B,KAAKG,IAAIH,KAAKE,IAAIJ,EAAc7B,KAGlC,SAASmC,EAAInC,GAClB,OAAO+B,KAAKG,IAAIH,KAAKI,IAAIN,EAAc7B,KCTzC,IAAI4B,EAAK,EAEF,SAASQ,IACd,OAAOR,IAGF,SAASS,EAAEC,GAChB,OAAOC,SAASC,cAAcF,GAOzB,IAAMG,EAAiB,SAAC/B,GAAD,MAC5B,CAAC,QAAS,SAAU,MAAO,OAAQ,UAAUgC,QAC3C,SAACC,EAAqBC,GACpB,MAAa,WAATA,EACK,2BACFD,GADL,kBAEGC,GAAQlC,EAAMkC,IAAgC,GAAK,OAG/C,2BACFD,GADL,IAEEE,UAAW,WAAanC,EAAMkC,IAAS,GAAK,WAIlD,KAkCG,SAASE,EAAkBpC,GAChC,OA3BK,SAAkBA,GAA8C,IAAxBqC,EAAuB,uDAAJ,GAC1DC,EAAW,CACf,WACA,QACA,SACA,MACA,OACA,cACA,gBACA,eACA,mBAEF,OAAOC,OAAOC,KAAKxC,GAAOgC,QAAO,SAACS,EAAaC,GAM7C,OALKL,EAAOM,SAASD,IACfJ,EAASK,SAASD,KACpBD,EAAOC,GAAO1C,EAAM0C,GAA8B,MAG/CD,IACN,IAQIG,CAAS5C,EAAO,CAAC,MAAO,OAAQ,WAQlC,SAAS6C,EACdC,EACA9C,GAEA,IAAQC,EAAkBD,EAAlBC,MAAOC,EAAWF,EAAXE,OACT6C,EAAO,IAAIC,KAAKF,GAChBG,EAAO,IAAID,KAAKF,GAChBI,EAAO,IAAIF,KAAKF,GAChBK,EAAO,IAAIH,KAAKF,GAClBM,EAAU,EACVC,EAAS,EAsBb,OAjBqB,IAAjBP,EAAMQ,QACRF,EAAUF,EAAO,EAAIjD,EACrBoD,EAASN,EAAO,EAAI7C,KAGhB6C,GAAQE,KACVG,EAAUnD,EAAQ,EAClBoD,EAASN,EAAO,EAAI7C,IAIlBgD,GAAQC,KACVC,EAAUF,EAAO,EAAIjD,EACrBoD,EAAShC,KAAKkC,MAAMrD,EAAS,KAI1B,CACLsD,WAAmB,OACnBC,UAAW,OACXhE,KAAK,GAAD,OAAK2D,EAAL,MACJ5D,IAAI,GAAD,OAAK6D,EAAL,OAwBA,SAASK,EAAyBC,GACvC,IAAM3D,EAAK,eAAQ2D,GAEb1D,EAAQ2D,OAAO5D,EAAMC,OACrBC,EAAS0D,OAAO5D,EAAME,QACtBT,EAAOmE,OAAO5D,EAAMP,MACpBD,EAAMoE,OAAO5D,EAAMR,KACnBF,EAASsE,OAAO5D,EAAMV,QAE5B,GAA6B,IAAzBsE,OAAO5D,EAAMV,QAAe,CAC9B,IAAMuE,EAAW5D,EAAQwB,EAAInC,GAAUY,EAASqB,EAAIjC,GAE9CwE,GAAS7D,EAAQ4D,GAAY,EACnC7D,EAAMP,KAAOqE,EAAQrE,EACrBO,EAAM+D,MAAQtE,EAAOoE,EAErB,IAAMG,EAAY9D,EAASuB,EAAInC,GAAUW,EAAQsB,EAAIjC,GAE/C2E,GAASD,EAAY9D,GAAU,EACrCF,EAAMR,IAAMA,EAAMyE,EAClBjE,EAAMkE,OAAS1E,EAAMwE,EAErBhE,EAAMC,MAAQ4D,EACd7D,EAAME,OAAS8D,OAEfhE,EAAMkE,OAAS1E,EAAMU,EACrBF,EAAM+D,MAAQtE,EAAOQ,EAGvB,OAAOD,E,+DCxJHmE,EAAO,CACX,WAAY,cAACC,EAAA,EAAD,IACZ,UAAW,cAACC,EAAA,EAAD,IACX,QAAS,cAACC,EAAA,EAAD,KAKX,SAASC,EAAQ3E,GACf,OAAOuE,EAAKvE,GAGd,IA4Be4E,EA5BY,WASzB,OACE,qBAAKC,YAL8B,SAAAC,GACnCA,EAAEC,aAAaC,QAAQ,QAASF,EAAEG,OAAOC,QAAQC,QAIjD,SACE,cAAC,IAAD,UACG/D,YAAItB,GAAgB,WAAkBqF,GAAlB,IAAGlF,EAAH,EAAGA,MAAOD,EAAV,EAAUA,KAAV,OACnB,cAAC,IAAD,CACEoF,KAAM,GAENhF,MAAO,CAAEiF,aAAc,GAAIvE,UAAW,UAHxC,SAKE,cAAC,IAAD,CAAQwE,KAAMX,EAAQ3E,GAAiB,aAAYmF,EAAOI,WAAS,EAAnE,SACGtF,KAJEA,WCZFuF,EAfCC,wBAAwC,CACtDC,kBAAmB,aACnBC,mBAAoB,EACpBC,eAAgB,CACdC,cAAe,GACfC,kBAAkB,EAClBC,SAAS,EACTC,UAAW,GACXC,eAAgB,EAChBC,gBAAiB,EACjBC,eAAgB,GAChBC,YAAa,MCJFZ,EARCC,wBAA+B,CAC7CY,aAAc,aACdC,UAAW,CACTC,SAAS,EACTC,SAAU,CAAE3G,KAAM,EAAGD,IAAK,M,iFCbjB6G,EAAS,CACpBC,SADoB,SACXC,GACHA,IACFC,OAAOC,SAASC,KAAOH,IAI3BI,QAPoB,SAOZC,GACFA,GACFD,IAAQE,KAAKD,KASNE,EAAY,CACvB,CACEpE,IAAK,UACL7C,MAAO,2BACPkH,MAAOV,EAAOM,QACdK,MAAO,IAET,CACEtE,IAAK,WACL7C,MAAO,2BACPkH,MAAOV,EAAOC,SACdU,MAAO,K,8CCIJ,SAASC,GACdC,GAGC,IAFDC,EAEA,uDAFO,OACPC,EACA,uCACMtH,EAAK,2BACNoH,EAAUpH,OADJ,IAETE,MAAOoC,EAAkB8E,EAAUlH,SAGrC,OAAQkH,EAAUtH,MAChB,IAAK,WACH,OAAO,cAAC,IAAD,2BAAYE,GAAZ,aAAoBoH,EAAUrH,SACvC,IAAK,UACH,MAAa,YAATsH,EAA2B,+BAAOD,EAAUrH,QAE9C,cAAC,IAAD,2BAAWC,GAAX,IAAkBuH,SAAU,SAAA3C,GAAC,cAAI0C,QAAJ,IAAIA,OAAJ,EAAIA,EAAgB1C,EAAEG,OAAOyC,WAE9D,IAAK,QACH,OACE,6CACEnC,UAAU,SACLrF,GAFP,IAGEyH,IAAKL,EAAUrH,UAQzB,IAAM2H,GAA+B,CACnC,KACA,IACA,KACA,IACA,KACA,IACA,KACA,KAWIC,GAAwB,SAAC,GAMxB,IALL1C,EAKI,EALJA,MACA2C,EAII,EAJJA,UACAC,EAGI,EAHJA,kBACAC,EAEI,EAFJA,OACAC,EACI,EADJA,cAEA,EACEC,qBAAWC,GADLvC,EAAR,EAAQA,eAAgBD,EAAxB,EAAwBA,kBAAmBD,EAA3C,EAA2CA,kBAEnCW,EAAiB6B,qBAAWE,GAA5B/B,aACAH,EAAkDN,EAAlDM,eAAgBC,EAAkCP,EAAlCO,eAAgBN,EAAkBD,EAAlBC,cAElCwC,EC7FD,SAAqBX,GAC1B,IAAMY,EAAMC,mBAIZ,OAHAC,qBAAU,WACRF,EAAIG,QAAUf,KAETY,EAAIG,QDwFeC,CAAYvC,GAEtC,EAAkCwC,mBAAwBZ,GAA1D,mBAAOT,EAAP,KAAkBsB,EAAlB,KAEItB,EAAUhG,GAKd,IAAMuH,EAAYN,iBAAOxG,EAAE,YAMrB+G,EAAaC,aAAS,SAAC3I,GAC3BsF,EAAkB,CAChBsD,KAAM,oBACNC,QAAS,CAAE7I,QAAO+E,aAEnB,KAMG+D,EAAqB,SAAC9I,GAC1BwI,EAAa,2BAAKtB,GAAN,IAAiBlH,WAC7B0I,EAAW1I,IA+KPoH,EAAgBuB,aAAS,SAAC9I,GAC9ByF,EAAkB,CAChBsD,KAAM,oBACNC,QAAS,CAAE9D,MAAOQ,EAAmBtE,OAAQ,CAAEpB,cAEhD,KAgCH,OA3BAuI,qBAAU,WACR,GACElB,EAAUhG,KAAO4E,IAChBiD,YAAQhD,KACRiD,YAAQjD,EAAgBkC,GACzB,CACA,IAAMjI,EAAQiJ,aAAM/B,EAAUlH,MAAO+F,GACrC+C,EAAmB9I,GAEnBsF,EAAkB,CAAEsD,KAAM,2BAA4BC,QAAS,QAEhE,CAAC9C,IAEJqC,qBAAU,WAENtC,IAAmBoB,EAAUhG,KAC5B6H,YAAQtD,IACTF,GAAqB,GAErBiD,EAAa/C,EAAcF,IAGzB2D,YAAMT,EAAUJ,WAClBI,EAAUJ,QAAU1G,EAAE,cAEvB,CAAC8D,IAGF,sBACEvE,GAAE,oBAAegG,EAAUhG,IAC3BiI,UAAWzB,EACX1H,MAAO+B,EAAemF,EAAUlH,OAChCoJ,QArKmC,SAAA1E,GAErCA,EAAE2E,kBACF3E,EAAE4E,iBAEFrD,EAAa,CAAE2C,KAAM,UAiKnBW,YAnNsC,SAAA7E,GACxCA,EAAE2E,kBAEF/D,EAAkB,CAAEsD,KAAM,WAAYC,SAAS,IAC/CvD,EAAkB,CAChBsD,KAAM,kBACNC,QAAS,CAAE3H,GAAIgG,EAAUhG,MAG3B,IAAMlB,EAAK,eAAQkH,EAAUlH,OAEvBwJ,EAAS9E,EAAE+E,QACXC,EAAShF,EAAEiF,QAEXC,EAAWhG,OAAO5D,EAAMR,KACxBqK,EAAYjG,OAAO5D,EAAMP,MAEzBqK,EAAO,SAACC,GACZ,IAAMC,EAAQD,EAAUJ,QAClBM,EAAQF,EAAUN,QAExBzJ,EAAMR,IAAMyK,EAAQT,EAASI,EAC7B5J,EAAMP,KAAOuK,EAAQN,EAASG,EAE9Bf,EAAmB9I,GAEnB4H,EAAOlD,EAAG1E,IAWZ6B,SAASqI,iBAAiB,YAAaJ,GACvCjI,SAASqI,iBAAiB,WATf,SAALC,IACJtI,SAASuI,oBAAoB,YAAaN,GAC1CjI,SAASuI,oBAAoB,UAAWD,GAGxCtC,QA4KF,UAOG/B,IAAmBoB,EAAUhG,IAC5B,qCACE,cAACmJ,EAAA,EAAD,CACElB,UAAS,UAAKzB,EAAL,WACT6B,YAjHiC,SAAA7E,GAAM,IAAD,EAC9CY,EAAkB,CAAEsD,KAAM,WAAYC,SAAS,IAC/CnE,EAAE4E,iBACF5E,EAAE2E,kBAGF,IAAM1F,EAAG,eAAQuD,EAAUlH,OACrBwJ,EAAS9E,EAAE+E,QACXC,EAAShF,EAAEiF,QACXW,EAAc3G,EAAIrE,OAGlBiL,EAAI,UAAG9B,EAAUJ,eAAb,aAAG,EAAmBmC,wBAC1BC,EAAUF,EAAM9K,KAAO8K,EAAMtK,MAAQ,EACrCyK,EAAUH,EAAM/K,IAAM+K,EAAMrK,OAAS,EAGrCyK,EACJtJ,KAAKuJ,MAAMpB,EAASkB,EAAShB,EAASe,IAAYpJ,KAAKC,GAAK,KAExDwI,EAAO,SAACC,GACZ,IAAMc,EAAOd,EAAUJ,QACjBmB,EAAOf,EAAUN,QAEjBsB,EACJ1J,KAAKuJ,MAAME,EAAOJ,EAASG,EAAOJ,IAAYpJ,KAAKC,GAAK,KAG1DqC,EAAIrE,OAASsE,OAAO0G,GAAeS,EAAoBJ,EACvD7B,EAAmBnF,IAQrB9B,SAASqI,iBAAiB,YAAaJ,GACvCjI,SAASqI,iBAAiB,WANf,SAALC,IACJtI,SAASuI,oBAAoB,YAAaN,GAC1CjI,SAASuI,oBAAoB,UAAWD,SAWvB,WACnB,IAAMlK,EAAQiH,EAAUlH,MAAMC,MACxBC,EAASgH,EAAUlH,MAAME,OAC/B,OAAOc,YAAIwG,IAAc,SAAA1E,GACvB,OACE,qBACEqG,UAAS,UAAKzB,EAAL,UACT1H,MAAO6C,EAAcC,EAAO,CAAE7C,QAAOC,WAErCqJ,YAAa,SAAA7E,GAAC,OApGG,SAAC5B,EAAqBkI,GAC7CA,EAAU3B,kBACV2B,EAAU1B,iBAEV,IAAM3F,EAAG,eAAQuD,EAAUlH,OACrBE,EAAS0D,OAAOD,EAAIzD,QACpBD,EAAQ2D,OAAOD,EAAI1D,OACnBT,EAAMoE,OAAOD,EAAInE,KACjBC,EAAOmE,OAAOD,EAAIlE,MAClBiK,EAASsB,EAAUrB,QACnBH,EAASwB,EAAUvB,QAEnBK,EAAO,SAACC,GACZ,IAAMC,EAAQD,EAAUJ,QAElBsB,EADQlB,EAAUN,QACHD,EACf0B,EAAOlB,EAAQN,EACf3G,EAAO,IAAIC,KAAKF,GAChBG,EAAO,IAAID,KAAKF,GAChBI,EAAO,IAAIF,KAAKF,GAChBK,EAAO,IAAIH,KAAKF,GAEhBkB,EAAY9D,GAAU6C,GAAQkI,EAAOhI,EAAOgI,EAAO,GACnDpH,EAAW5D,GAASiD,GAAQgI,EAAO/H,EAAO+H,EAAO,GACvDvH,EAAIzD,OAAS8D,EAAY,EAAIA,EAAY,EACzCL,EAAI1D,MAAQ4D,EAAW,EAAIA,EAAW,EACtCF,EAAIlE,KAAOA,GAAQyD,EAAOgI,EAAO,GACjCvH,EAAInE,IAAMA,GAAOuD,EAAOkI,EAAO,GAE/BnC,EAAmBnF,IAQrB9B,SAASqI,iBAAiB,YAAaJ,GACvCjI,SAASqI,iBAAiB,WANf,SAALC,IACJtI,SAASuI,oBAAoB,YAAaN,GAC1CjI,SAASuI,oBAAoB,UAAWD,MAkElBgB,CAAiBrI,EAAO4B,KADrC5B,MA8DJsI,MAGJnE,GAAkBC,EAAW,OAAQE,OAK5CK,GAAM4D,aAAe,CACnB3D,UAAW,qBAGED,UEvVTA,GAAwB,SAAC,GAA8B,IAA5BC,EAA2B,EAA3BA,UAAWR,EAAgB,EAAhBA,UAElCzB,EADmBqC,qBAAWC,GAA9BvC,eACAC,cAYR,OACE,qBACE0D,UAAWzB,EACX1H,MAAO+B,EAAemF,EAAUlH,OAChCoJ,QAdY,WACd,IAAMkC,EAAeC,YAAK9F,EAAe,CAAC,KAAMyB,EAAUhG,KACpDsK,GAAiC,OAAZF,QAAY,IAAZA,OAAA,EAAAA,EAAcjF,SAAU,GAC9C0C,YAAQyC,IACXC,YAAQD,GAAoB,SAAAzE,GAC1BV,EAAOU,EAAMrE,KAAKqE,EAAMO,WAM5B,SAKGL,GAAkBC,EAAW,cAKpCO,GAAM4D,aAAe,CACnB3D,UAAW,qBAGED,UCjCTiE,GAA4B,SAAC,GAAmB,IAAjBhE,EAAgB,EAAhBA,UACnC,EACEI,qBAAWC,GADLvC,EAAR,EAAQA,eAAgBF,EAAxB,EAAwBA,kBAEhBG,EAAwCD,EAAxCC,cAAeE,EAAyBH,EAAzBG,QAASK,EAAgBR,EAAhBQ,YAKhC,OACE,cAAC,IAAD,CACEG,QAASR,EACTgG,OAAQ,KACRC,UAAU,EACV3L,MAAO+F,EAAY/F,MACnBD,MAAK,2BAAOgG,GAAP,IAAoBxG,IAAK,KAC9B2J,UAAWzB,EACXmE,SAXY,kBACdvG,EAAkB,CAAEsD,KAAM,aAAcC,SAAS,KAGjD,SASG7H,YAAIyE,GAAe,SAAAyB,GAClB,OAAO,cAAC,GAAD,CAA0BA,UAAWA,GAAzBA,EAAUhG,UAMrCwK,GAAQL,aAAe,CACrB3D,UAAW,uBAGEgE,UC1BAI,GAJa,SAAAhM,GAC1B,OAAO,qBAAKE,MAAOF,EAAOqJ,UAVV,sBCIZ4C,GAAoC,SAAC,GAAmB,IAAjBrE,EAAgB,EAAhBA,UACnCpC,EAAsBwC,qBAAWC,GAAjCzC,kBACAY,EAAc4B,qBAAWE,GAAzB9B,UACAC,EAAsBD,EAAtBC,QAASC,EAAaF,EAAbE,SAqCjB,OACE,qBACE+C,UAAWzB,EACX1H,MAAK,aAAIgM,WAAY7F,EAAU,UAAY,UAAaC,GAF1D,SAIE,qBACE6F,UAAW,kBAAM3G,EAAkB,CAAEsD,KAAM,WAAYC,SAAS,KADlE,UAGE,oBAAIO,QAnCK,kBAAM9D,EAAkB,CAAEsD,KAAM,UAmCzC,0BACA,oBAAIQ,QA/BM,kBAAM9D,EAAkB,CAAEsD,KAAM,QAASC,QAASzC,KA+B5D,0BACA,oBAAIgD,QA1CQ,kBAAM9D,EAAkB,CAAEsD,KAAM,sBA0C5C,0BACA,oBAAIQ,QA5BI,kBAAM9D,EAAkB,CAAEsD,KAAM,SA4BxC,0BACA,oBAAIQ,QAxBO,kBAAM9D,EAAkB,CAAEsD,KAAM,YAwB3C,0BACA,oBAAIQ,QApBG,kBAAM9D,EAAkB,CAAEsD,KAAM,QAoBvC,0BACA,oBAAIQ,QAhBK,kBAAM9D,EAAkB,CAAEsD,KAAM,UAgBzC,gCAMRmD,GAAYV,aAAe,CACzB3D,UAAW,oBAGEqE,UC1BAG,GA/CE,WACf,OACE,sBACE/C,UAAU,OACVlJ,MAAM,OACNC,OAAO,OACPiM,MAAM,6BACNnM,MAAO,CAAEoG,SAAU,WAAY5G,IAAK,EAAGC,KAAM,EAAG2M,WAAY,QAL9D,UAOE,iCACE,yBACElL,GAAG,YACHjB,MAAM,cACNC,OAAO,cACPmM,aAAa,iBAJf,SAME,sBACEC,EAAE,sCACFC,KAAK,OACLC,OAAO,2BACPC,YAAY,QAGhB,0BACEvL,GAAG,OACHjB,MAAM,eACNC,OAAO,eACPmM,aAAa,iBAJf,UAME,sBACEpM,MAAM,eACNC,OAAO,eACPqM,KAAK,oBAEP,sBACED,EAAE,wCACFC,KAAK,OACLC,OAAO,2BACPC,YAAY,YAIlB,sBAAMxM,MAAM,OAAOC,OAAO,OAAOqM,KAAK,mB,UCxBtCG,GAAuB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAGtDC,GAAmB,CACvBC,IAAI,EACJC,IAAI,EACJC,IAAI,EACJC,IAAI,EACJC,IAAI,EACJC,IAAI,GAEAC,GAAkB,CACtBN,GAAI,GACJC,GAAI,GACJC,GAAI,GACJC,GAAI,GACJC,GAAI,GACJC,GAAI,IAiBN,SAASE,GAAeC,EAAmBC,GACzC,OAAOhM,KAAKG,IAAI4L,EAAYC,IAjCZ,EAoClB,IAAMC,GAAWC,sBACf,WAAgBrF,GAAS,IAAtBR,EAAqB,EAArBA,UACD,EACEI,qBAAWC,GADLvC,EAAR,EAAQA,eAAgBF,EAAxB,EAAwBA,kBAEhBQ,EAAkCN,EAAlCM,eAAgBL,EAAkBD,EAAlBC,cACxB,EAAoC8C,mBAASoE,IAA7C,mBAAOa,EAAP,KAAmBC,EAAnB,KACA,EAAkClF,mBAAS2E,IAA3C,mBAAOQ,EAAP,KAAkBC,EAAlB,KA4BMC,EAAyC,SAAA5N,GAE7C,IAAM6N,EAAoBnK,EAAyB1D,GAG7C8N,EAAwBlK,OAAOiK,EAAkB5N,OAAS,EAC1D8N,EAAyBnK,OAAOiK,EAAkB3N,QAAU,EAC5D8N,EAAoBpK,OAAOiK,EAAkB5N,OAC7CgO,EAAqBrK,OAAOiK,EAAkB3N,QAC9CgO,EAAmBtK,OAAOiK,EAAkBpO,MAC5C0O,EAAoBvK,OAAOiK,EAAkB9J,OAC7CqK,EAAkBxK,OAAOiK,EAAkBrO,KAC3C6O,EAAqBzK,OAAOiK,EAAkB3J,QAEpDuH,YAAQhG,GAAe,SAAAyB,GAErB,GAAIA,EAAUhG,KAAO4E,EAArB,CAEA,IAAMwI,EAAiB5K,EAAyBwD,EAAUlH,OACpDC,EAAQ2D,OAAO0K,EAAerO,OAC9BC,EAAS0D,OAAO0K,EAAepO,QAC/BV,EAAMoE,OAAO0K,EAAe9O,KAC5B0E,EAASN,OAAO0K,EAAepK,QAC/BzE,EAAOmE,OAAO0K,EAAe7O,MAC7BsE,EAAQH,OAAO0K,EAAevK,OAC9BwK,EAAqBtO,EAAQ,EAC7BuO,EAAsBtO,EAAS,EAE/BuO,EAAa,CACjBjP,IAAK,CACH,CAEEkP,KAAM,KAENC,SAAUxB,GAAeiB,EAAiB5O,GAE1CoP,UAAWpP,EAEXqP,UAAWrP,GAEb,CACEmP,SAAUxB,GAAekB,EAAoB7O,GAC7CkP,KAAM,KACNE,UAAWpP,EAAMyO,EACjBY,UAAWrP,GAEb,CACEmP,SAAUxB,GACRiB,EAAkBL,EAClBvO,EAAMgP,GAERE,KAAM,KACNE,UAAWpP,EAAMgP,EAAsBT,EACvCc,UAAWrP,EAAMgP,GAEnB,CACEG,SAAUxB,GAAeiB,EAAiBlK,GAC1CwK,KAAM,KACNE,UAAW1K,EACX2K,UAAW3K,GAEb,CACEyK,SAAUxB,GAAekB,EAAoBnK,GAC7CwK,KAAM,KACNE,UAAW1K,EAAS+J,EACpBY,UAAW3K,IAGfzE,KAAM,CACJ,CACEkP,SAAUxB,GAAee,EAAkBzO,GAC3CiP,KAAM,KACNE,UAAWnP,EACXoP,UAAWpP,GAEb,CACEkP,SAAUxB,GAAegB,EAAmB1O,GAC5CiP,KAAM,KACNE,UAAWnP,EAAOuO,EAClBa,UAAWpP,GAEb,CACEkP,SAAUxB,GACRe,EAAmBJ,EACnBrO,EAAO8O,GAETG,KAAM,KACNE,UAAWnP,EAAO8O,EAAqBT,EACvCe,UAAWpP,EAAO8O,GAEpB,CACEI,SAAUxB,GAAee,EAAkBnK,GAC3C2K,KAAM,KACNE,UAAW7K,EACX8K,UAAW9K,GAEb,CACE4K,SAAUxB,GAAegB,EAAmBpK,GAC5C2K,KAAM,KACNE,UAAW7K,EAAQiK,EACnBa,UAAW9K,KAMX+K,EAAY,eAAQpB,GAEpBqB,EAAa,eAAQpC,IAC3BlB,YAAQgD,GAAY,SAACO,EAAWtM,GAC9B+I,YAAQuD,GAAW,SAAAC,GACjB,IAAQP,EAAyCO,EAAzCP,KAAMC,EAAmCM,EAAnCN,SAAUC,EAAyBK,EAAzBL,UAAWC,EAAcI,EAAdJ,UAE9BF,IAELpM,OAAO2M,OAAOH,EAAdxM,OAAA,IAAAA,CAAA,GAAgCmM,EAAOC,IACvCpM,OAAO2M,OAAOJ,EAAdvM,OAAA,IAAAA,CAAA,GACGmM,EAAOC,EAAQ,2BACPG,EAAaJ,IADN,kBACyBhM,EAAMmM,IAC3C,KAGNvJ,EAAkB,CAChBsD,KAAM,2BACNC,QAAQ,eAAInG,EAAMkM,YAKxBjB,EAAamB,GAtJW,SAACC,GAc3BtB,EAAcsB,GAyIZI,CAAoBJ,QAYxB,OALAK,8BAAoBlH,GAAK,iBAAO,CAC9B0F,WACAyB,SAAU,kBAAM5B,EAAcd,SAI9B,qBAAKxD,UAAWzB,EAAhB,SACG1G,YAAI0L,IAAW,SAAAgC,GAAI,OAClB,qBAEEvF,UAAS,UAAKzB,EAAL,iBACP/E,aAAS+L,EAAM,KAAf,UAAyBhH,EAAzB,oBAAgDA,EAAhD,WAEF1H,MAAK,aACHsP,QAAS9B,EAAWkB,GAAQ,QAAU,QACnChB,EAAUgB,KANVA,WAejBpB,GAASjC,aAAe,CACtB3D,UAAW,oBAGE4F,UCvOTiC,GAA0B,SAAC,GAAmB,IAAjB7H,EAAgB,EAAhBA,UACzBlC,EAAmBsC,qBAAWC,GAA9BvC,eACAS,EAAiB6B,qBAAWE,GAA5B/B,aAER,EAAgCsC,oBAAS,GAAzC,mBAAOiH,EAAP,KAAiBC,EAAjB,KAGMC,EAAcvH,iBAAyB,MAEvCM,EAAYN,iBAAOxG,EAAE,YACrBgO,EAAexH,iBAAO,CAAEyH,QAAS,EAAGC,QAAS,IAC7CC,EAAW3H,iBAAO,CAAE4H,EAAG,EAAGC,EAAG,IACnC,EAAwBzH,mBAAS,CAAEtI,MAAO,EAAGC,OAAQ,IAArD,mBAAO+P,EAAP,KAAaC,EAAb,KACMC,EAAUhI,iBAAO,CAAElI,MAAO,EAAGC,OAAQ,IAEnCuF,EAA+BD,EAA/BC,cAAeO,EAAgBR,EAAhBQ,YAmCjBoK,EAAyC,SAAC1L,EAAG1E,GAAW,IAAD,EAC3D,UAAA0P,EAAYrH,eAAZ,SAAqBuF,SAAS5N,IAM1BqQ,EAAqB,WAAO,IAAD,EAC/B,UAAAX,EAAYrH,eAAZ,SAAqBgH,YAqCjBiB,EAAoB,WACxB,IAAMC,EA/BgB,WACtB,MAAiBT,EAASzH,QAAlB0H,EAAR,EAAQA,EAAGC,EAAX,EAAWA,EACX,EAA2CG,EAAQ9H,QAApCmI,EAAf,EAAQvQ,MAAuBwQ,EAA/B,EAAuBvQ,OAEvB,OAAO8B,YACLyD,GACA,SAAChD,EAAyByE,GACxB,IAAMzH,EAAOmE,OAAOsD,EAAUlH,MAAMP,MAC9BD,EAAMoE,OAAOsD,EAAUlH,MAAMR,KAC7BS,EAAQ2D,OAAOsD,EAAUlH,MAAMC,OAC/BC,EAAS0D,OAAOsD,EAAUlH,MAAME,QAStC,OAPE6P,GAAKtQ,GACLuQ,GAAKxQ,GACLC,EAAOQ,GAAS8P,EAAIS,GACpBhR,EAAMU,GAAU8P,EAAIS,GAEpBhO,EAAOiO,KAAKxJ,GAEPzE,IAET,IAUqBkO,GAEvB,GAAIJ,EAAejN,QAAU,EAC3BmM,GAAY,OADd,CAKA,MAA6BE,EAAatH,QAAlCuH,EAAR,EAAQA,QAASC,EAAjB,EAAiBA,QAEbrQ,EAAMoR,IACNnR,EAAOmR,IACP7M,GAAS6M,IACT1M,GAAU0M,IAEdnF,YAAQ8E,GAAgB,SAAArJ,GAAc,IAAD,EAC7BlH,EAAgC,GAChCuK,EAAI,UAAG5I,EAAE,cAAD,OAAeuF,EAAUhG,YAA7B,aAAG,EAAiCsJ,wBAC9CxK,EAAMP,KAAO8K,EAAM9K,KAAOmQ,EAC1B5P,EAAMR,IAAM+K,EAAM/K,IAAMqQ,EACxB7P,EAAM+D,MAAQwG,EAAMxG,MAAQ6L,EAC5B5P,EAAMkE,OAASqG,EAAMrG,OAAS2L,EAE1B7P,EAAMP,KAAOA,IAAMA,EAAOO,EAAMP,MAChCO,EAAMR,IAAMA,IAAKA,EAAMQ,EAAMR,KAC7BQ,EAAM+D,MAAQA,IAAOA,EAAQ/D,EAAM+D,OACnC/D,EAAMkE,OAASA,IAAQA,EAASlE,EAAMkE,WAG5C4L,EAASzH,QAAU,CAAE0H,EAAGtQ,EAAMuQ,EAAGxQ,GACjC0Q,EAAQ,CAAEjQ,MAAO8D,EAAQtE,EAAMS,OAAQgE,EAAS1E,MA6ElD,OAVA4I,qBAAU,WACJc,YAAMT,EAAUJ,WAClBI,EAAUJ,QAAU1G,EAAE,cAEvB,CAAC8G,EAAUJ,UAEdD,qBAAU,WACR+H,EAAQ9H,QAAU4H,IACjB,CAACA,IAGF,sBACE9G,UAAWzB,EACX1H,MAAOgG,EACP9E,GAAG,SACH2P,cA1LoC,SAAAnM,GACtCA,EAAE2E,kBACF3E,EAAE4E,iBAOF,IALA,IAAIzE,EAASH,EAAEG,OACXrF,EAAMkF,EAAEoM,YAAYC,QACpBtR,EAAOiF,EAAEoM,YAAYE,QAGlBnM,aAAkBoM,YACvBpM,EAASA,EAAOqM,WAIlB,MAAQrM,EAAOsE,UAAUxG,SAAS,uBAChClD,GAAQoF,EAAOsM,WACf3R,GAAOqF,EAAOuM,UACdvM,EAASA,EAAOqM,WAGlBjL,EAAa,CAAE2C,KAAM,SACrB3C,EAAa,CAAE2C,KAAM,cAAeC,QAAS,CAAEpJ,OAAMD,UAsKnD+J,YA5EuC,SAAA7E,GAAM,IAAD,EAE9CA,EAAE4E,iBAKFmG,GAAY,GACZS,EAAQ,CAAEjQ,MAAO,EAAGC,OAAQ,IAG5B,IAAMqK,EAAI,UAAG9B,EAAUJ,eAAb,aAAG,EAAmBmC,wBAChCmF,EAAatH,QAAU,CACrBuH,QAASrF,EAAMwF,EACfF,QAAStF,EAAMyF,GAIjB,IAAMtG,EAAShF,EAAEiF,QACXH,EAAS9E,EAAE+E,QAEjBqG,EAASzH,QAAU,CACjB0H,EAAGrG,EAASiG,EAAatH,QAAQuH,QACjCI,EAAGxG,EAASmG,EAAatH,QAAQwH,SAInCJ,GAAY,GAEZ,IAAM3F,EAAO,SAACC,GACZmG,EAAQ,CACNjQ,MAAOoB,KAAKG,IAAIuI,EAAUJ,QAAUD,GACpCxJ,OAAQmB,KAAKG,IAAIuI,EAAUN,QAAUD,KAEnCO,EAAUJ,QAAUD,IACtBoG,EAASzH,QAAQ0H,EAAIhG,EAAUJ,QAAUgG,EAAatH,QAAQuH,SAG5D7F,EAAUN,QAAUD,IACtBsG,EAASzH,QAAQ2H,EAAIjG,EAAUN,QAAUkG,EAAatH,QAAQwH,UAiBlEhO,SAASqI,iBAAiB,YAAaJ,GACvCjI,SAASqI,iBAAiB,WAdf,SAALC,EAAMzF,GAIV,GAHA7C,SAASuI,oBAAoB,YAAaN,GAC1CjI,SAASuI,oBAAoB,UAAWD,GAEpCzF,EAAEiF,UAAYD,GAAUhF,EAAE+E,UAAYD,EAGxC,OAFAiG,GAAY,QACZS,EAAQ,CAAEjQ,MAAO,EAAGC,OAAQ,IAI9BoQ,QAkBF,UAOE,cAAC,GAAD,IAECtP,YAAIyE,GAAe,SAACyB,EAAWnC,GAC9B,OACE,cAAC,GAAD,CAEEA,MAAOA,EACP4C,kBAAmBT,EACnBU,OAAQwI,EACRvI,cAAewI,GAJVnJ,EAAUhG,OASrB,cAAC,GAAD,IAEA,cAAC,GAAD,CAAUgH,IAAKwH,IAEf,cAAC,GAAD,IAECF,GACC,cAAC,GAAD,CACEhQ,IAAKsQ,EAASzH,QAAQ2H,EACtBvQ,KAAMqQ,EAASzH,QAAQ0H,EACvB9P,MAAOgQ,EAAKhQ,MACZC,OAAQ+P,EAAK/P,aAOvBqP,GAAOlE,aAAe,CACpB3D,UAAW,sBAGE6H,U,sECjQF8B,GAAkB,CAC7B,CACEzR,KAAM,QACNC,MAAO,eACPyR,cAAe,QACfxR,MAAO,IAET,CACEF,KAAM,UACNC,MAAO,qBACPyR,cAAe,QACfxR,MAAO,IAET,CACEF,KAAM,QACNC,MAAO,eACPyR,cAAe,QACfxR,MAAO,IAET,CACEF,KAAM,SACNC,MAAO,eACPyR,cAAe,QACfxR,MAAO,IAET,CACEF,KAAM,WACNC,MAAO,2BACPyR,cAAe,QACfxR,MAAO,IAET,CACEF,KAAM,aACNC,MAAO,2BACPyR,cAAe,QACfxR,MAAO,IAET,CACEF,KAAM,aACNC,MAAO,qBACPyR,cAAe,QACfxR,MAAO,IAET,CACEF,KAAM,cACNC,MAAO,qBACPyR,cAAe,QACfxR,MAAO,IAET,CACEF,KAAM,YACNC,MAAO,2BACPyR,cAAe,SACfxR,MAAO,CACLyR,QArEmB,CACvB,CACE1R,MAAO,2BACPyH,MAAO,QAET,CACEzH,MAAO,2BACPyH,MAAO,UAET,CACEzH,MAAO,2BACPyH,MAAO,a,UCLHkK,GAAYC,KAAZD,QAmEOE,GA3DG,WAChB,MACE5J,qBAAWC,GADLzC,EAAR,EAAQA,kBAEAQ,EAFR,EAA2BN,eAEnBM,eACR,EAA8ByC,oBAAS,GAAvC,mBAAOpC,EAAP,KAAgBwL,EAAhB,KACA,EAA0BpJ,mBAAS,IAAnC,mBAAOjB,EAAP,KAAcsK,EAAd,KACA,EAAsBrJ,mBAAgC,WAAtD,mBAAOsJ,EAAP,KAAYC,EAAZ,KAEA,OACE,gCACGhM,GAAkB,GACjB,cAAC,IAAD,CAAQ8C,KAAK,UAAUQ,QAAS,kBAAMuI,GAAW,IAAjD,sCAKF,eAAC,KAAD,CACE1R,MAAO,IACP8R,UAAU,QACVnG,UAAU,EACVoG,QAAS,kBAAML,GAAW,IAC1BxL,QAASA,EALX,UAOE,cAAC,KAAD,CACE8L,UAAWJ,EACXxK,SAAU,SAAA4K,GAAS,OAAIH,EAAOG,IAFhC,SAIGjR,YAAI8F,GAAW,SAAAoL,GAAS,OACvB,cAACV,GAAD,CAASK,IAAKK,EAAUrS,MAAxB,SACE,cAAC,IAAMsS,SAAP,CACE7K,MAAOA,EACPD,SAAU,SAAA3C,GAAC,OAAIkN,EAASlN,EAAEG,OAAOyC,WAHD4K,EAAUxP,UASlD,cAAC,IAAD,CACE1C,MAAO,CAAEyD,UAAW,IACpB2F,QAAS,WACP9D,EAAkB,CAChBsD,KAAM,eACNC,QAAS,CACPnG,IAAKmP,EACLvK,WAGJsK,EAAS,IACTjL,IAAQyL,QAAQ,wCAChBT,GAAW,IAZf,iC,6BCzCMU,GAAaC,KAAnBC,KACAf,GAAYC,KAAZD,QAMFgB,GAAgB,CACpBjT,aAASkT,EACTxS,WAAOwS,EACPvS,YAAQuS,EACRnS,cAAUmS,EACVlS,gBAAYkS,EACZjS,gBAAYiS,EACZC,iBAAaD,EACb/R,eAAW+R,EACX5S,WAAO4S,GAGHE,GAAa,CAAC,SAMdC,GAAiB5R,YAAIqQ,IAAiB,SAAApQ,GAC1C,IACIiG,EADIoK,EAAuCrQ,EAAvCqQ,cAAexR,EAAwBmB,EAAxBnB,MAAU+S,EAAjC,aAA+C5R,EAA/C,IAEA,OAAQqQ,GACN,IAAK,SACHpK,EAAY,cAAC,KAAD,eAAYpH,IACxB,MACF,QACEoH,EAAY,cAAC,IAAD,eAAWpH,IAE3B,OACE,cAACuS,GAAD,2BAAmCQ,GAAnC,aACG3L,IADY2L,EAAUjT,SAMvBkT,GAA8B,SAAC,GAAmB,IAAjBpL,EAAgB,EAAhBA,UACrC,EACEI,qBAAWC,GADLvC,EAAR,EAAQA,eAAgBD,EAAxB,EAAwBA,kBAAmBD,EAA3C,EAA2CA,kBAEnCQ,EAA6CN,EAA7CM,eAAgBL,EAA6BD,EAA7BC,cAAeG,EAAcJ,EAAdI,UACvC,EAA8B2C,mBAA8BiK,IAA5D,mBAAOO,EAAP,KAAgBC,EAAhB,KACA,EAAeV,KAAKW,UAAbC,EAAP,oBACMC,EAAiBhL,kBAAO,GAExBiL,EAAQzK,YAASuK,EAAKG,YAAa,KAKnCC,EAAsB3K,aAAS,SAAA1H,GACnCqE,EAAkB,CAChBsD,KAAM,oBACNC,QAAS,CAAE9D,MAAOQ,EAAmBtE,cAEtC,KAyCH,OAtBAmH,qBAAU,WACR,IAAIyF,EAA0B2E,GAC9B,GAAI1M,GAAkB,EAAG,CACvB,IAAMwF,EAAeC,YAAK9F,EAAe,CAAC,KAAMK,IAE5CwF,IACFuC,EAAiB,2BACZvC,EAAatL,OADD,IAEfH,MAAOyL,EAAazL,SAG1BmT,EAAWnF,KACV,CAAC/H,EAAgBL,IAEpB2C,qBAAU,WACJ+K,EAAe9K,QACjB8K,EAAe9K,SAAU,EAG3B+K,MACC,CAACL,IAGF,qBAAK5J,UAAWzB,EAAhB,SACE,eAAC,KAAD,CAAM6L,iBAAiB,WAAvB,UACE,cAAC,GAAD,CAASC,aAAW,EAAC3B,IAAI,eAAzB,SACG/L,GAAkB,EACjB,cAAC,KAAD,CACE2N,OAAO,EACPP,KAAMA,EACNQ,SAAU,CAAE1O,KAAM,GAClBwN,cAAeO,EACfY,eA5CwC,SAClDC,EACAC,GAEA,IAAQhU,EAAUgU,EAAVhU,MACFiU,EAAWC,aAAKF,EAAQlB,IAC9B,GAAIpN,GAAqB,EAAG,CAC1B,IAAMvF,EAAK,2BAAQyF,EAAcF,GAAmBvF,OAAU8T,GAC9DR,EAAoB,CAAEzT,QAAOG,YA+BvB,SAOG4S,KAGH,kCAZ8B,YAelC,cAAC,GAAD,CAASf,IAAI,eAAb,SACG7Q,YAAI4E,GAAW,SAACoO,EAAUjP,GACzB,IAAMkP,EAAQC,aAAKlT,YAAIgT,EAAU,MAAO,KACxC,OACE,eAAC,KAAD,CAAuBG,MAAK,iBAAOpP,EAAQ,EAAf,WAA5B,kBACQkP,IADR,UAAclP,QAJE,aAUtB,cAAC,GAAD,CAAS8M,IAAI,eAAb,SACE,cAAC,GAAD,KADoB,eAQ9BiB,GAASzH,aAAe,CACtB3D,UAAW,wBAGEoL,UC3ETsB,GAAiB,CACrB,mBACA,eACA,eACA,SACA,OACA,OACA,MACA,MASIC,GAA4B,SAChCC,EACAC,EACA1P,GAEA,IAAM2P,EAA2B,YAAOF,GADrC,EAEwC,CACzCE,EAAW3P,GACX2P,EAAWD,IAEb,OAJCC,EAAWD,GAFT,KAEkBC,EAAW3P,GAF7B,KAMI2P,GAGM,SAASC,GACtBC,EACAC,GAEA,IAAQ/L,EAAkB+L,EAAlB/L,KAAMC,EAAY8L,EAAZ9L,QACVtD,GAAqB,EASzB,OAPI5C,aAASyR,GAAgBxL,KAC3BrD,EAAoBqP,YAAUF,EAAMjP,cAAe,CACjD,KACAiP,EAAM5O,kBAIF8C,GACN,IAAK,mBACH,OAAO,2BAAK8L,GAAZ,IAAmBjP,cAAeoD,IAEpC,IAAK,oBACH,IAAQ5H,EAAkB4H,EAAlB5H,OAAQ8D,EAAU8D,EAAV9D,MACVU,EAAgBoP,YAAUH,EAAMjP,eAEtC,OADAlD,OAAO2M,OAAOzJ,EAAcV,GAA5BxC,OAAA,IAAAA,CAAA,GAAyCtB,IAClC,2BAAKyT,GAAZ,IAAmBjP,kBAErB,IAAK,oBACH,IAAQzF,EAAiB6I,EAAjB7I,MAAO+E,EAAU8D,EAAV9D,MACT+P,EAAWD,YAAUH,GAE3B,OADAnS,OAAO2M,OAAO4F,EAASrP,cAAcV,GAAQ,CAAE/E,UACxC8U,EAET,IAAK,mBACH,IAAMC,EAAa,YAAOL,EAAMjP,eAC5BuP,EAAWnM,EAOf,YANiB4J,IAAbuC,IACFA,EAAWzP,GAETyP,GAAY,GACdD,EAAcE,OAAOD,EAAU,GAE1B,2BAAKN,GAAZ,IAAmBjP,cAAesP,IAEpC,IAAK,kBACH,OAAO,2BACFL,GADL,IAEE5O,eAAgB+C,EAAQ3H,KAE5B,IAAK,2BACH,OAAO,2BACFwT,GADL,IAEE3O,eAAgB8C,IAEpB,IAAK,WACH,OAAO,2BAAK6L,GAAZ,IAAmBhP,iBAAkBmD,IACvC,IAAK,OACH,IAAMiM,EAAQ,eAAQJ,GAItB,OAFAI,EAASrP,cACPqP,EAASlP,YAAYkP,EAASjP,gBAAkB,GAC3CiP,EAET,IAAK,OACH,GAAIJ,EAAM7O,cAAgB6O,EAAM9O,UAAUtC,OAAS,EAAG,CACpD,IAAM4R,EAAmBR,EAAM7O,cAAgB,EAC/C,OAAO,2BACF6O,GADL,IAEE7O,cAAeqP,EACfzP,cAAeiP,EAAM9O,UAAUsP,KAGnC,OAAOR,EACT,IAAK,OACH,OAAO,2BAAKA,GAAZ,IAAmBS,SAAUT,EAAMjP,cAAcF,KACnD,IAAK,QACH,IAAM6P,EAAOP,YAAUH,EAAMS,UAC7B,OAAKC,GAIL7S,OAAO2M,OAAOkG,EAAM,CAClBpV,MAAM,2BAAMoV,EAAKpV,OAAU6I,GAC3B3H,GAAIQ,MAEC,2BAAKgT,GAAZ,IAAmBjP,cAAc,GAAD,mBAAMiP,EAAMjP,eAAZ,CAA2B2P,QAPzDzO,IAAQ0O,MAAM,kCACPX,GAQX,IAAK,MACH,IAAMK,EAAa,YAAOL,EAAMjP,eAEhC,OAAIsP,EAAczR,OAAS,EAClBoR,EAEF,2BACFA,GADL,IAEEjP,cAAe4O,GACbU,EACAxP,EACAwP,EAAczR,OAAS,KAI7B,IAAK,SACH,IAAMyR,EAAa,YAAOL,EAAMjP,eAEhC,OAAIsP,EAAczR,OAAS,EAClBoR,EAEF,2BACFA,GADL,IAEEjP,cAAe4O,GACbU,EACAxP,EACA,KAIN,IAAK,KACH,IAAMwP,EAAa,YAAOL,EAAMjP,eAEhC,OACEsP,EAAczR,OAAS,GACvBiC,IAAsBwP,EAAczR,OAAS,EAEtCoR,EAEF,2BACFA,GADL,IAEEjP,cAAe4O,GACbU,EACAxP,EACAA,EAAoB,KAI1B,IAAK,OACH,IAAMwP,EAAa,YAAOL,EAAMjP,eAEhC,OAAIsP,EAAczR,OAAS,GAA2B,IAAtBiC,EACvBmP,EAEF,2BACFA,GADL,IAEEjP,cAAe4O,GACbU,EACAxP,EACAA,EAAoB,KAI1B,IAAK,iBAAmB,IAAD,EACfuP,EAAQ,eAAQJ,GAWtB,OAVAI,EAASlP,YAAYkP,EAASjP,eAA9B,OAA+CgD,QAA/C,IAA+CA,GAA/C,UAA+CA,EAC3CjD,iBADJ,aAA+C,EAC/B,GAGZkP,EAASjP,cAAgBiP,EAASlP,UAAUtC,OAAS,IACvDwR,EAASlP,UAAYkP,EAASlP,UAAU0P,MACtC,EACAR,EAASjP,cAAgB,IAGtBiP,EAET,IAAK,aACH,OAAO,2BAAKJ,GAAZ,IAAmB/O,QAASkD,IAC9B,IAAK,eACH,IAAMpD,EAAgBoP,YAAUH,EAAMjP,eAChC6F,EAAe7F,EAAcF,GACnC+F,EAAajF,OAASiF,EAAajF,QAAU,GAC7C,IAAMkP,EAAoBX,YAAUtJ,EAAajF,OAAQ,CACvD,MACAwC,EAAQnG,MAOV,OALI6S,GAAqB,EACvBjK,EAAajF,OAAO4O,OAAOM,EAAmB,EAAG1M,GAEjDyC,EAAajF,OAAOqK,KAAK7H,GAEpB,2BAAK6L,GAAZ,IAAmBjP,kBAErB,IAAK,eACH,OAAO,2BAAKiP,GAAZ,IAAmB/O,QAASkD,IAC9B,IAAK,iBACH,OAAO,2BAAK6L,GAAZ,IAAmB1O,YAAY,2BAAM0O,EAAM1O,aAAgB6C,KAC7D,QACE,MAAM,IAAI2M,OC9QD,SAASf,GACtBC,EACAC,GAEA,IAAQ/L,EAAkB+L,EAAlB/L,KAAMC,EAAY8L,EAAZ9L,QAEd,OAAQD,GACN,IAAK,OACH,OAAO,2BAAK8L,GAAZ,IAAmBvO,SAAS,IAC9B,IAAK,OACH,OAAO,2BAAKuO,GAAZ,IAAmBvO,SAAS,IAC9B,IAAK,cACH,OAAO,2BAAKuO,GAAZ,IAAmBtO,SAAUyC,K,+BCuEpB4M,GA1FmB,SAAC,GAG5B,IAAD,IAFJ/N,iBAEI,MAFQ,qBAER,EADJgO,EACI,EADJA,SAEA,EACE5N,qBAAWC,GADLzC,EAAR,EAAQA,kBAEAG,EAFR,EAA2BD,eAEnBC,cA0CFkQ,EAAsB,SAACjT,EAAa4E,GAAd,OAC1BhC,EAAkB,CAAEsD,KAAM,iBAAkBC,QAAQ,eAAInG,EAAM4E,MAEhE,OACE,wBAAQ6B,UAAWzB,EAAnB,SACE,eAAC,KAAD,CAAOkO,KAAM,GAAb,UACE,cAAC,IAAD,CAAQA,KAAK,QAAQxM,QArBZ,WACb9D,EAAkB,CAAEsD,KAAM,UAoBtB,0BAGA,cAAC,IAAD,CAAQgN,KAAK,QAAQxM,QAlCT,WACR,OAARsM,QAAQ,IAARA,OACApQ,EAAkB,CAChBsD,KAAM,UA+BJ,0BAGA,cAAC,IAAD,CAAQgN,KAAK,QAAQxM,QApBT,kBAChB9D,EAAkB,CAAEsD,KAAM,aAAcC,SAAS,KAmB7C,0BAGA,cAAC,IAAD,CAAQ+M,KAAK,QAAQxM,QApDZ,WACb9D,EAAkB,CAChBsD,KAAM,iBACNC,QAAS,CACPjD,UAAW,CAACH,OAgDZ,0BAIA,eAAC,KAAD,sCAEE,cAAC,KAAD,CACEmQ,KAAK,QACLC,IAAK,EACLC,IAAK,KACLC,aAAc,KACd1O,SAAU,SAAAC,GAAK,OAAIqO,EAAoB,QAASrO,MAPpD,IAUE,cAAC,KAAD,CACEsO,KAAK,QACLC,IAAK,EACLC,IAAK,IACLC,aAAc,IACd1O,SAAU,SAAAC,GAAK,OAAIqO,EAAoB,SAAUrO,eCxEvD0O,GAAsB,SAAC,GAAmB,IAAjBtO,EAAgB,EAAhBA,UAC7B,EAA4CuO,qBAAWC,GAAkB,CACvExQ,kBAAkB,EAClBC,SAAS,EACTE,eAAgB,EAChBC,gBAAiB,EACjBF,UAAW,GACXG,eAAgB,GAChBC,YAAa,CAAE/F,MAAO,KAAMC,OAAQ,KACpCuF,cAAe,CACb,CACEvE,GAAI,EACJtB,KAAM,WACNC,MAAO,eACPC,MAAO,GACPE,MAAO,CACLC,MAAO,IACPC,OAAQ,GACRC,YAAa,EACbC,YAAa,GACbC,aAAc,GACdC,SAAU,GACVC,WAAY,IACZC,WAAY,GACZC,cAAe,EACfC,UAAW,GACXC,MAAO,GACPC,gBAAiB,GACjBtB,OAAQ,EACRC,QAAS,EACTC,IAAK,GACLC,KAAM,SA9Bd,mBAAO+F,EAAP,KAAuBF,EAAvB,KAmCA,EAAkC2Q,qBAAWE,GAAgB,CAC3DhQ,SAAS,EACTC,SAAU,CAAE3G,KAAM,EAAGD,IAAK,KAF5B,mBAAO0G,EAAP,KAAkBD,EAAlB,KAIQR,EACND,EADMC,cAAeC,EACrBF,EADqBE,iBAAkBI,EACvCN,EADuCM,eAAgBE,EACvDR,EADuDQ,YAInDT,EAAoB6Q,mBACxB,kBAAMxB,YAAUnP,EAAe,CAAC,KAAMK,MACtC,CAACL,EAAeK,IAoDlB,OACE,qBAAKqD,UAAWzB,EAAhB,SACE,cAAC,EAAqB2O,SAAtB,CACE/O,MAAO,CACL/B,oBACAC,iBACAF,qBAJJ,SAOE,eAAC,EAAmB+Q,SAApB,CAA6B/O,MAAO,CAAEpB,YAAWD,gBAAjD,UACE,cAAC,GAAD,IACA,sBAAKkD,UAAS,UAAKzB,EAAL,YAAd,UACE,qBAAKyB,UAAS,UAAKzB,EAAL,iBAAd,SACE,cAAC,EAAD,MAEF,qBAAKyB,UAAS,UAAKzB,EAAL,oBAAkC1H,MAAOgG,EAAvD,SACE,qBACEmD,UAAS,UAAKzB,EAAL,2BACT4O,OA/DkB,SAAA5R,GAC9BA,EAAE4E,iBACF5E,EAAE2E,kBACF,IAAMnC,EAAY2N,YAChBnV,EAAekE,OAAOc,EAAEC,aAAa4R,QAAQ,YAE/CrP,EAAUlH,MAAMR,IAAMkF,EAAEoM,YAAYC,QACpC7J,EAAUlH,MAAMP,KAAOiF,EAAEoM,YAAYE,QACrC9J,EAAUhG,GAAKQ,IACf4D,EAAkB,CAChBsD,KAAM,mBACNC,QAAQ,GAAD,mBAAMpD,GAAN,CAAqByB,OAqDlBsP,WA7CsB,SAAA9R,GAElCA,EAAE4E,iBACF5E,EAAEC,aAAa8R,WAAa,QA2ChBxK,UApCqB,SAAAvH,GAC5BgB,GAEHgR,YAAW,WACTpR,EAAkB,CAChBsD,KAAM,kBACNC,QAAS,CAAE3H,IAAK,OAEjB,GAGY,IAAbwD,EAAEiS,QACJ1Q,EAAa,CAAE2C,KAAM,UAyBXW,YAAa,kBACXjE,EAAkB,CAAEsD,KAAM,WAAYC,SAAS,KANnD,SASE,cAAC,GAAD,QAGJ,qBAAKM,UAAS,UAAKzB,EAAL,iBAAd,SACE,cAAC,GAAD,iBASdsO,GAAK3K,aAAe,CAClB3D,UAAW,QAGEsO,UCpJAY,OARf,WACE,OACE,qBAAKzN,UAAU,MAAf,SACE,cAAC,GAAD,OCAN0N,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,IAAD,CAAgBC,OAAQC,IAAxB,SACE,cAAC,GAAD,QAGJpV,SAASqV,eAAe,W","file":"static/js/main.eaf25c23.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/cat.2fdfd017.jpeg\";","import { map } from 'lodash-es';\n\n// 公共样式\nexport const commonStyle = {\n  rotate: 0,\n  opacity: 1,\n  top: 0,\n  left: 0\n};\n\nexport const COMPONENT_LIST = (() => {\n  const baseConfig = [\n    {\n      name: 'r-input',\n      label: '文字',\n      props: {\n        placeholder: '请输入'\n      },\n      style: {\n        width: 200,\n        height: 32\n      }\n    },\n    {\n      name: 'r-button',\n      label: '按钮',\n      props: {},\n      style: {\n        width: 100,\n        height: 32,\n        borderWidth: 1,\n        borderColor: '',\n        borderRadius: '',\n        fontSize: 14,\n        fontWeight: 500,\n        lineHeight: '',\n        letterSpacing: 0,\n        textAlign: '',\n        color: '',\n        backgroundColor: ''\n      }\n    },\n    {\n      name: 'r-img',\n      label: '图片',\n      props: {\n        src: require('@/assets/cat.jpeg').default\n      },\n      style: {\n        width: 192,\n        height: 120\n      }\n    }\n  ];\n\n  return map(baseConfig, config => ({\n    // 未创建的ID\n    id: -1,\n    ...config,\n    style: { ...config.style, ...commonStyle }\n  }));\n})();\n","/**\n * 角度转弧度（Math.PI = 180 度）\n * @param angle 角度\n */\nfunction angleToRadian(angle: number) {\n  return (angle * Math.PI) / 180;\n}\n\nexport function sin(rotate: number) {\n  return Math.abs(Math.sin(angleToRadian(rotate)));\n}\n\nexport function cos(rotate: number) {\n  return Math.abs(Math.cos(angleToRadian(rotate)));\n}\n","import { CSSProperties } from 'react';\n\nimport { cos, sin } from './translate';\n\nlet id = 1;\n\nexport function generateID() {\n  return id++;\n}\n\nexport function $(selector: string) {\n  return document.querySelector(selector);\n}\n\n/**\n * 给样式添加单位\n * @param style\n */\nexport const transformStyle = (style: CSSProperties) =>\n  ['width', 'height', 'top', 'left', 'rotate'].reduce(\n    (prev: CSSProperties, attr) => {\n      if (attr !== 'rotate') {\n        return {\n          ...prev,\n          [attr]: (style[attr as keyof CSSProperties] || 0) + 'px'\n        };\n      } else {\n        return {\n          ...prev,\n          transform: 'rotate(' + (style[attr] || 0) + 'deg)'\n        };\n      }\n    },\n    {}\n  );\n\n/**\n * 生成组件样式\n * @param style\n * @param filter\n */\nexport function getStyle(style: CSSProperties, filter: string[] = []) {\n  const needUnit = [\n    'fontSize',\n    'width',\n    'height',\n    'top',\n    'left',\n    'borderWidth',\n    'letterSpacing',\n    'borderRadius',\n    'backgroundImage'\n  ];\n  return Object.keys(style).reduce((result: any, key) => {\n    if (!filter.includes(key)) {\n      if (needUnit.includes(key)) {\n        result[key] = style[key as keyof CSSProperties] + 'px';\n      }\n    }\n    return result;\n  }, {});\n}\n\n/**\n * 过滤组件样式\n * @param style\n */\nexport function getComponentStyle(style: CSSProperties) {\n  return getStyle(style, ['top', 'left', 'rotate']);\n}\n\n/**\n * 获取 `点` 的位置\n * @param point\n * @param style\n */\nexport function getPointStyle(\n  point: string,\n  style: { width: number; height: number }\n) {\n  const { width, height } = style;\n  const hasT = /t/.test(point);\n  const hasB = /b/.test(point);\n  const hasL = /l/.test(point);\n  const hasR = /r/.test(point);\n  let newLeft = 0;\n  let newTop = 0;\n\n  // console.log(point);\n\n  // 四个角的点\n  if (point.length === 2) {\n    newLeft = hasL ? 0 : width;\n    newTop = hasT ? 0 : height;\n  } else {\n    // 上下两点的点，宽度居中\n    if (hasT || hasB) {\n      newLeft = width / 2;\n      newTop = hasT ? 0 : height;\n    }\n\n    // 左右两边的点，高度居中\n    if (hasL || hasR) {\n      newLeft = hasL ? 0 : width;\n      newTop = Math.floor(height / 2);\n    }\n  }\n\n  return {\n    marginLeft: hasR ? '-4px' : '-4px',\n    marginTop: '-4px',\n    left: `${newLeft}px`,\n    top: `${newTop}px`\n  };\n}\n\n/**\n * 欺骗 TS 生成 Int 类型样式值\n * @param style\n */\nexport function fakeTsIntStyle(style: CSSProperties) {\n  return ['width', 'height', 'left', 'top'].reduce(\n    (result: Record<string, number>, key) => {\n      Object.assign(result, {\n        [key]: style[key as keyof CSSProperties] as number\n      });\n      return result;\n    },\n    {}\n  );\n}\n\n/**\n * 获取一个组件旋转 rotate 后的样式\n * @param pos\n */\nexport function getComponentRotatedStyle(pos: CSSProperties) {\n  const style = { ...pos };\n\n  const width = Number(style.width);\n  const height = Number(style.height);\n  const left = Number(style.left);\n  const top = Number(style.top);\n  const rotate = Number(style.rotate);\n\n  if (Number(style.rotate) !== 0) {\n    const newWidth = width * cos(rotate) + height * sin(rotate);\n    // 旋转后范围变小是正值，变大是负值\n    const diffX = (width - newWidth) / 2;\n    style.left = diffX + left;\n    style.right = left + newWidth;\n\n    const newHeight = height * cos(rotate) + width * sin(rotate);\n    // 始终是正\n    const diffY = (newHeight - height) / 2;\n    style.top = top - diffY;\n    style.bottom = top + newHeight;\n\n    style.width = newWidth;\n    style.height = newHeight;\n  } else {\n    style.bottom = top + height;\n    style.right = left + width;\n  }\n\n  return style;\n}\n","import {\n  BoldOutlined,\n  FileImageOutlined,\n  FileTextOutlined\n} from '@ant-design/icons';\nimport { Button, Col, Row } from 'antd';\nimport { map } from 'lodash-es';\nimport React, { FC } from 'react';\n\nimport { DragEventMethod } from '@/types';\n\nimport { COMPONENT_LIST } from './data';\n\nconst maps = {\n  'r-button': <BoldOutlined />,\n  'r-input': <FileTextOutlined />,\n  'r-img': <FileImageOutlined />\n};\n\ntype MapKey = keyof typeof maps;\n\nfunction getIcon(name: MapKey) {\n  return maps[name];\n}\n\nconst BaseComponents: FC = () => {\n  /**\n   * 用于保存拖动并放下（drag and drop）过程中的数据\n   * @param e { DragEvent<HTMLDivElement> }\n   */\n  const onDragStart: DragEventMethod = e => {\n    e.dataTransfer.setData('index', e.target.dataset.index);\n  };\n\n  return (\n    <div onDragStart={onDragStart}>\n      <Row>\n        {map(COMPONENT_LIST, ({ label, name }, index) => (\n          <Col\n            span={12}\n            key={label}\n            style={{ marginBottom: 12, textAlign: 'center' }}\n          >\n            <Button icon={getIcon(name as MapKey)} data-index={index} draggable>\n              {label}\n            </Button>\n          </Col>\n        ))}\n      </Row>\n    </div>\n  );\n};\n\nexport default BaseComponents;\n","import { createContext } from 'react';\n\nimport {\n  ComponentDataReducerAction,\n  ComponentDataReducerState\n} from '../reducer/component-data';\n\nexport interface ComponentDataContextType {\n  componentState: ComponentDataReducerState;\n  curComponentIndex: number;\n  componentDispatch: ({ type, payload }: ComponentDataReducerAction) => void;\n}\n\nconst Context = createContext<ComponentDataContextType>({\n  componentDispatch: () => {},\n  curComponentIndex: -1,\n  componentState: {\n    componentData: [],\n    isClickComponent: false,\n    preview: false,\n    snapshots: [],\n    snapshotIndex: -1,\n    curComponentId: -1,\n    dragShiftStyle: {},\n    canvasStyle: {}\n  }\n});\n\nexport default Context;\n","import { createContext } from 'react';\n\nimport {\n  ComponentDataReducerAction,\n  ContextMenuReducerState\n} from '../reducer/context-menu';\n\nexport interface ContextMenuType {\n  menuState: ContextMenuReducerState;\n  menuDispatch: ({ type, payload }: ComponentDataReducerAction) => void;\n}\n\nconst Context = createContext<ContextMenuType>({\n  menuDispatch: () => {},\n  menuState: {\n    visible: false,\n    position: { left: 0, top: 0 }\n  }\n});\n\nexport default Context;\n","import { message } from 'antd';\n\n// 编辑器自定义事件\nexport const events = {\n  redirect(url: string) {\n    if (url) {\n      window.location.href = url;\n    }\n  },\n\n  message(msg: string) {\n    if (msg) {\n      message.info(msg);\n    }\n  }\n};\n\nexport const mixins = {\n  methods: events\n};\n\nexport const eventList = [\n  {\n    key: 'message',\n    label: '消息提醒',\n    event: events.message,\n    param: ''\n  },\n  {\n    key: 'redirect',\n    label: '跳转事件',\n    event: events.redirect,\n    param: ''\n  }\n];\n","import './index.less';\n\nimport { RedoOutlined } from '@ant-design/icons';\nimport { Button, Input } from 'antd';\nimport { debounce, isEmpty, isEqual, isNil, map, merge } from 'lodash-es';\nimport React, {\n  CSSProperties,\n  FC,\n  ImgHTMLAttributes,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState\n} from 'react';\n\nimport { usePrevious } from '@/hooks/use-previous';\nimport {\n  ComponentType,\n  DragEventMethod,\n  MouseEventMethod,\n  MouseEventWithStyleMethod,\n  PointPosType\n} from '@/types';\nimport { $, getComponentStyle, getPointStyle, transformStyle } from '@/utils';\n\nimport ComponentDataContext from '../context/component-data';\nimport ContextMenuContext from '../context/context-menu';\n\n/**\n * 根据组件类型，生成画布上的组件\n * @param component {ComponentType} 组件json\n * @param mode {'preview' | 'edit'} 预览模式 || 编辑模式\n * @param onInputChange {(label: string) => void}\n * @return {ReactNode}\n */\nexport function generateComponent(\n  component: ComponentType,\n  mode = 'edit',\n  onInputChange?: (label: string) => void\n) {\n  const props = {\n    ...component.props,\n    style: getComponentStyle(component.style)\n  };\n\n  switch (component.name) {\n    case 'r-button':\n      return <Button {...props}>{component.label}</Button>;\n    case 'r-input':\n      if (mode === 'preview') return <span>{component.label}</span>;\n      return (\n        <Input {...props} onChange={e => onInputChange?.(e.target.value)} />\n      );\n    case 'r-img': {\n      return (\n        <img\n          draggable=\"false\"\n          {...(props as ImgHTMLAttributes<HTMLImageElement>)}\n          alt={component.label}\n        />\n      );\n    }\n  }\n}\n\n// 8个光标点\nconst SHAPE_POINTS: PointPosType[] = [\n  'lt',\n  't',\n  'rt',\n  'r',\n  'rb',\n  'b',\n  'lb',\n  'l'\n];\n\ninterface ShapeProps {\n  prefixCls?: string;\n  index: number;\n  originalComponent: ComponentType;\n  onMove: MouseEventWithStyleMethod;\n  onDestroyMove: () => void;\n}\n\nconst Shape: FC<ShapeProps> = ({\n  index,\n  prefixCls,\n  originalComponent,\n  onMove,\n  onDestroyMove\n}) => {\n  const { componentState, curComponentIndex, componentDispatch } =\n    useContext(ComponentDataContext);\n  const { menuDispatch } = useContext(ContextMenuContext);\n  const { curComponentId, dragShiftStyle, componentData } = componentState;\n  // 上一次吸附的样式\n  const preDragShiftStyle = usePrevious(dragShiftStyle);\n  // 每个组件独立处理自己的配置，防止频繁刷新引起的卡顿\n  const [component, setComponent] = useState<ComponentType>(originalComponent);\n\n  if (component.id === curComponentId) {\n    // console.log(component);\n  }\n\n  // 画布的实例\n  const editorRef = useRef($('#editor'));\n\n  /**\n   * 更新 store 的组件样式\n   * @param style {CSSProperties} 更新后样式\n   */\n  const onSyncData = debounce((style: CSSProperties) => {\n    componentDispatch({\n      type: 'setComponentStyle',\n      payload: { style, index }\n    });\n  }, 100);\n\n  /**\n   * 样式更改\n   * @param style {CSSProperties} 更新后样式\n   */\n  const onChangeShapeStyle = (style: CSSProperties) => {\n    setComponent({ ...component, style });\n    onSyncData(style);\n  };\n\n  /**\n   * 组件按下鼠标事件处理器(开始拖拽)\n   * @param e\n   */\n  const onShapeMouseDown: DragEventMethod = e => {\n    e.stopPropagation();\n\n    componentDispatch({ type: 'setClick', payload: true });\n    componentDispatch({\n      type: 'setCurComponent',\n      payload: { id: component.id }\n    });\n\n    const style = { ...component.style };\n    // 拖拽起点的 xy 坐标\n    const startY = e.clientY;\n    const startX = e.clientX;\n    // 组件开始 xy 坐标\n    const startTop = Number(style.top);\n    const startLeft = Number(style.left);\n\n    const move = (moveEvent: any) => {\n      const currX = moveEvent.clientX;\n      const currY = moveEvent.clientY;\n      // 当前最新的 xy 坐标(基于document)减去最开始的 xy 坐标(基于document)，加上起始位置 xy 坐标(基于画布)\n      style.top = currY - startY + startTop;\n      style.left = currX - startX + startLeft;\n\n      onChangeShapeStyle(style);\n      // 配合吸附线-显示\n      onMove(e, style);\n    };\n\n    const up = () => {\n      document.removeEventListener('mousemove', move);\n      document.removeEventListener('mouseup', up);\n\n      // 配合吸附线-销毁\n      onDestroyMove();\n    };\n\n    document.addEventListener('mousemove', move);\n    document.addEventListener('mouseup', up);\n  };\n\n  /**\n   * 点击事件处理器\n   * @param e\n   */\n  const onShapeClick: MouseEventMethod = e => {\n    // 阻止向父组件冒泡\n    e.stopPropagation();\n    e.preventDefault();\n    // 关闭右键菜单\n    menuDispatch({ type: 'hide' });\n  };\n\n  /**\n   * 8个点按下鼠标事件处理器\n   * @param point 点位\n   * @param downEvent 事件\n   */\n  const onPointMouseDown = (point: PointPosType, downEvent: any) => {\n    downEvent.stopPropagation();\n    downEvent.preventDefault();\n\n    const pos = { ...component.style };\n    const height = Number(pos.height);\n    const width = Number(pos.width);\n    const top = Number(pos.top);\n    const left = Number(pos.left);\n    const startX = downEvent.clientX;\n    const startY = downEvent.clientY;\n\n    const move = (moveEvent: any) => {\n      const currX = moveEvent.clientX;\n      const currY = moveEvent.clientY;\n      const disY = currY - startY;\n      const disX = currX - startX;\n      const hasT = /t/.test(point);\n      const hasB = /b/.test(point);\n      const hasL = /l/.test(point);\n      const hasR = /r/.test(point);\n\n      const newHeight = height + (hasT ? -disY : hasB ? disY : 0);\n      const newWidth = width + (hasL ? -disX : hasR ? disX : 0);\n      pos.height = newHeight > 0 ? newHeight : 0;\n      pos.width = newWidth > 0 ? newWidth : 0;\n      pos.left = left + (hasL ? disX : 0);\n      pos.top = top + (hasT ? disY : 0);\n\n      onChangeShapeStyle(pos);\n    };\n\n    const up = () => {\n      document.removeEventListener('mousemove', move);\n      document.removeEventListener('mouseup', up);\n    };\n\n    document.addEventListener('mousemove', move);\n    document.addEventListener('mouseup', up);\n  };\n\n  /**\n   * 按下旋转按钮处理器\n   * 核心在 Math.atan2 方法，返回一个旋转的弧度\n   * @param e\n   */\n  const onRotateMouseDown: DragEventMethod = e => {\n    componentDispatch({ type: 'setClick', payload: true });\n    e.preventDefault();\n    e.stopPropagation();\n\n    // 初始坐标和初始角度\n    const pos = { ...component.style } as any;\n    const startY = e.clientY;\n    const startX = e.clientX;\n    const startRotate = pos.rotate;\n\n    // 获取元素中心点位置\n    const rect = editorRef.current?.getBoundingClientRect();\n    const centerX = rect!.left + rect!.width / 2;\n    const centerY = rect!.top + rect!.height / 2;\n\n    // 旋转前的角度\n    const rotateDegreeBefore =\n      Math.atan2(startY - centerY, startX - centerX) / (Math.PI / 180);\n\n    const move = (moveEvent: any) => {\n      const curX = moveEvent.clientX;\n      const curY = moveEvent.clientY;\n      // 旋转后的角度\n      const rotateDegreeAfter =\n        Math.atan2(curY - centerY, curX - centerX) / (Math.PI / 180);\n\n      // 获取旋转的角度值\n      pos.rotate = Number(startRotate) + rotateDegreeAfter - rotateDegreeBefore;\n      onChangeShapeStyle(pos);\n    };\n\n    const up = () => {\n      document.removeEventListener('mousemove', move);\n      document.removeEventListener('mouseup', up);\n    };\n\n    document.addEventListener('mousemove', move);\n    document.addEventListener('mouseup', up);\n  };\n\n  /**\n   * 组件 active 状态下标记8个点\n   * @return {ReactNode}\n   */\n  const shapePointEl = () => {\n    const width = component.style.width as number;\n    const height = component.style.height as number;\n    return map(SHAPE_POINTS, point => {\n      return (\n        <div\n          className={`${prefixCls}-point`}\n          style={getPointStyle(point, { width, height })}\n          key={point}\n          onMouseDown={e => onPointMouseDown(point, e)}\n        />\n      );\n    });\n  };\n\n  /**\n   * 更新 input label\n   * @param label {string}\n   */\n  const onInputChange = debounce((label: string) => {\n    componentDispatch({\n      type: 'setComponentProps',\n      payload: { index: curComponentIndex, config: { label } }\n    });\n  }, 1000);\n\n  /**\n   * 吸附事件处理器\n   */\n  useEffect(() => {\n    if (\n      component.id === curComponentId &&\n      !isEmpty(dragShiftStyle) &&\n      !isEqual(dragShiftStyle, preDragShiftStyle)\n    ) {\n      const style = merge(component.style, dragShiftStyle);\n      onChangeShapeStyle(style);\n      // 吸附完成进行重置操作\n      componentDispatch({ type: 'setCurComponentDragShift', payload: {} });\n    }\n  }, [dragShiftStyle]);\n\n  useEffect(() => {\n    if (\n      curComponentId === component.id &&\n      !isEmpty(componentData) &&\n      curComponentIndex > -1\n    ) {\n      setComponent(componentData[curComponentIndex]);\n    }\n\n    if (isNil(editorRef.current)) {\n      editorRef.current = $('#editor');\n    }\n  }, [componentData]);\n\n  return (\n    <div\n      id={`component-${component.id}`}\n      className={prefixCls}\n      style={transformStyle(component.style)}\n      onClick={onShapeClick}\n      onMouseDown={onShapeMouseDown}\n    >\n      {curComponentId === component.id && (\n        <>\n          <RedoOutlined\n            className={`${prefixCls}-rotate`}\n            onMouseDown={onRotateMouseDown}\n          />\n          {shapePointEl()}\n        </>\n      )}\n      {generateComponent(component, 'edit', onInputChange)}\n    </div>\n  );\n};\n\nShape.defaultProps = {\n  prefixCls: 'visual-drag-shape'\n};\n\nexport default Shape;\n","/**\n * usePrevious\n * @Date:   2021-07-28 14:27\n */\nimport { useEffect, useRef } from 'react';\nexport function usePrevious(value: any) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n","/**\n * Shape\n * @Date:   2021-08-08 17:16\n */\nimport './index.less';\n\nimport { find, forEach, isEmpty } from 'lodash-es';\nimport React, { FC, useContext } from 'react';\n\nimport { ComponentType } from '@/types';\nimport { transformStyle } from '@/utils';\nimport { events } from '@/utils/events';\n\nimport ComponentDataContext from '../../context/component-data';\nimport { generateComponent } from '../Shape';\n\ninterface ShapeProps {\n  prefixCls?: string;\n  component: ComponentType;\n}\n\nconst Shape: FC<ShapeProps> = ({ prefixCls, component }) => {\n  const { componentState } = useContext(ComponentDataContext);\n  const { componentData } = componentState;\n\n  const onClick = () => {\n    const curComponent = find(componentData, ['id', component.id]);\n    const curComponentEvents = curComponent?.events || [];\n    if (!isEmpty(curComponentEvents)) {\n      forEach(curComponentEvents, event => {\n        events[event.key](event.value);\n      });\n    }\n  };\n\n  return (\n    <div\n      className={prefixCls}\n      style={transformStyle(component.style)}\n      onClick={onClick}\n    >\n      {generateComponent(component, 'preview')}\n    </div>\n  );\n};\n\nShape.defaultProps = {\n  prefixCls: 'visual-drag-shape'\n};\n\nexport default Shape;\n","/**\n * 预览弹窗\n * @Date:   2021-08-08 17:01\n */\nimport './index.less';\n\nimport { Modal } from 'antd';\nimport { map } from 'lodash-es';\nimport React, { FC, useContext } from 'react';\n\nimport ComponentDataContext from '../../context/component-data';\nimport Shape from './Shape';\n\ninterface PreviewProps {\n  prefixCls?: string;\n}\n\nconst Preview: FC<PreviewProps> = ({ prefixCls }) => {\n  const { componentState, componentDispatch } =\n    useContext(ComponentDataContext);\n  const { componentData, preview, canvasStyle } = componentState;\n\n  const onClose = () =>\n    componentDispatch({ type: 'setPreview', payload: false });\n\n  return (\n    <Modal\n      visible={preview}\n      footer={null}\n      closable={false}\n      width={canvasStyle.width}\n      style={{ ...canvasStyle, top: 50 }}\n      className={prefixCls}\n      onCancel={onClose}\n    >\n      {map(componentData, component => {\n        return <Shape key={component.id} component={component} />;\n      })}\n    </Modal>\n  );\n};\n\nPreview.defaultProps = {\n  prefixCls: 'visual-drag-preview'\n};\n\nexport default Preview;\n","/**\n * Area\n * @Date:   2021-09-03 17:43\n */\n\nimport React, { FC } from 'react';\n\nconst prefixCls = 'visual-drag-area';\n\ninterface AreaProps {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n}\n\nconst Area: FC<AreaProps> = props => {\n  return <div style={props} className={prefixCls} />;\n};\n\nexport default Area;\n","import './index.less';\n\nimport React, { FC, useContext } from 'react';\n\nimport ComponentDataContext from '../context/component-data';\nimport ContextMenuContext from '../context/context-menu';\n\ninterface ContextMenuProps {\n  prefixCls?: string;\n}\n\nconst ContextMenu: FC<ContextMenuProps> = ({ prefixCls }) => {\n  const { componentDispatch } = useContext(ComponentDataContext);\n  const { menuState } = useContext(ContextMenuContext);\n  const { visible, position } = menuState;\n\n  /**\n   * 删除操作\n   */\n  const onDestroy = () => componentDispatch({ type: 'destroyComponent' });\n\n  /**\n   * 复制操作\n   */\n  const onCopy = () => componentDispatch({ type: 'copy' });\n\n  /**\n   * 黏贴操作\n   */\n  const onPaste = () => componentDispatch({ type: 'paste', payload: position });\n\n  /**\n   * 置顶操作\n   */\n  const onTop = () => componentDispatch({ type: 'top' });\n\n  /**\n   * 置底操作\n   */\n  const onBottom = () => componentDispatch({ type: 'bottom' });\n\n  /**\n   * 上移操作\n   */\n  const onUp = () => componentDispatch({ type: 'up' });\n\n  /**\n   * 下移操作\n   */\n  const onDown = () => componentDispatch({ type: 'down' });\n\n  return (\n    <div\n      className={prefixCls}\n      style={{ visibility: visible ? 'visible' : 'hidden', ...position }}\n    >\n      <ul\n        onMouseUp={() => componentDispatch({ type: 'setClick', payload: true })}\n      >\n        <li onClick={onCopy}>复制</li>\n        <li onClick={onPaste}>粘贴</li>\n        <li onClick={onDestroy}>删除</li>\n        <li onClick={onTop}>置顶</li>\n        <li onClick={onBottom}>置底</li>\n        <li onClick={onUp}>上移</li>\n        <li onClick={onDown}>下移</li>\n      </ul>\n    </div>\n  );\n};\n\nContextMenu.defaultProps = {\n  prefixCls: 'visual-drag-menu'\n};\n\nexport default ContextMenu;\n","import React, { FC } from 'react';\n\nconst Grid: FC = () => {\n  return (\n    <svg\n      className=\"grid\"\n      width=\"100%\"\n      height=\"100%\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      style={{ position: 'absolute', top: 0, left: 0, background: '#fff' }}\n    >\n      <defs>\n        <pattern\n          id=\"smallGrid\"\n          width=\"7.236328125\"\n          height=\"7.236328125\"\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <path\n            d=\"M 7.236328125 0 L 0 0 0 7.236328125\"\n            fill=\"none\"\n            stroke=\"rgba(207, 207, 207, 0.3)\"\n            strokeWidth=\"1\"\n          />\n        </pattern>\n        <pattern\n          id=\"grid\"\n          width=\"36.181640625\"\n          height=\"36.181640625\"\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <rect\n            width=\"36.181640625\"\n            height=\"36.181640625\"\n            fill=\"url(#smallGrid)\"\n          />\n          <path\n            d=\"M 36.181640625 0 L 0 0 0 36.181640625\"\n            fill=\"none\"\n            stroke=\"rgba(186, 186, 186, 0.5)\"\n            strokeWidth=\"1\"\n          />\n        </pattern>\n      </defs>\n      <rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" />\n    </svg>\n  );\n};\n\nexport default Grid;\n","/**\n * 吸附线\n * @Date:   2021-07-23 11:00\n */\nimport { find, forEach, includes, map, values } from 'lodash-es';\nimport React, {\n  CSSProperties,\n  forwardRef,\n  useContext,\n  useImperativeHandle,\n  useState\n} from 'react';\n\nimport { getComponentRotatedStyle } from '@/utils';\n\nimport ComponentDataContext from '../context/component-data';\n\ntype LineMap = 'xt' | 'xc' | 'xb' | 'yl' | 'yc' | 'yr';\n\n// 六条吸附线 分别对应三条横线和三条竖线\nconst LINES_MAP: LineMap[] = ['xt', 'xc', 'xb', 'yl', 'yc', 'yr'];\n// 相距 LINE_DIFF 像素将自动吸附\nconst LINE_DIFF = 3;\nconst INIT_LINE_STATUS = {\n  xt: false,\n  xc: false,\n  xb: false,\n  yl: false,\n  yc: false,\n  yr: false\n};\nconst INIT_LINE_STYLE = {\n  xt: {},\n  xc: {},\n  xb: {},\n  yl: {},\n  yc: {},\n  yr: {}\n};\n\ninterface MarkLineProps {\n  prefixCls?: string;\n}\n\nexport interface MarkLineRefProps {\n  showLine: (style: CSSProperties) => void;\n  hideLine: () => void;\n}\n\n/**\n * 判断是否需要显示吸附线 <= diff 像素\n * @param dragValue\n * @param targetValue\n */\nfunction decideIsNearly(dragValue: number, targetValue: number) {\n  return Math.abs(dragValue - targetValue) <= LINE_DIFF;\n}\n\nconst MarkLine = forwardRef<MarkLineRefProps, MarkLineProps>(\n  ({ prefixCls }, ref) => {\n    const { componentState, componentDispatch } =\n      useContext(ComponentDataContext);\n    const { curComponentId, componentData } = componentState;\n    const [lineStatus, setLineStatus] = useState(INIT_LINE_STATUS);\n    const [lineStyle, setLineStyle] = useState(INIT_LINE_STYLE);\n\n    /**\n     * 选择性的显示吸附线\n     * 处理多条吸附线共存的问题\n     * @param newLineStatus\n     */\n    const onChooseTheTureLine = (newLineStatus: typeof INIT_LINE_STATUS) => {\n      // const { xt, xc, xb, yl, yc, yr } = newLineStatus;\n      //\n      // if ((xt && xc && xb) || (yl && yc && yr)) {\n      //   if (xt && xc && xb) {\n      //     setLineStatus({ ...newLineStatus, xt: false, xc: true, xb: false });\n      //   }\n      //\n      //   if (yl && yc && yr) {\n      //     setLineStatus({ ...newLineStatus, yl: false, yc: true, yr: false });\n      //   }\n      //   return;\n      // }\n\n      setLineStatus(newLineStatus);\n    };\n\n    /**\n     * 判断是否显示吸附线 && 计算吸附线坐标\n     * @param style {CSSProperties}\n     */\n    const showLine: MarkLineRefProps['showLine'] = style => {\n      // 获取旋转后的 hover 组件样式\n      const curComponentStyle = getComponentRotatedStyle(style);\n\n      // hover 组件的属性\n      const curComponentHalfWidth = Number(curComponentStyle.width) / 2;\n      const curComponentHalfHeight = Number(curComponentStyle.height) / 2;\n      const curComponentWidth = Number(curComponentStyle.width);\n      const curComponentHeight = Number(curComponentStyle.height);\n      const curComponentLeft = Number(curComponentStyle.left);\n      const curComponentRight = Number(curComponentStyle.right);\n      const curComponentTop = Number(curComponentStyle.top);\n      const curComponentBottom = Number(curComponentStyle.bottom);\n\n      forEach(componentData, component => {\n        // 吸附线只挂载在`主动吸附`的组件，当前组件属于`被吸附`\n        if (component.id === curComponentId) return;\n        // 获取当前组件的旋转后样式\n        const componentStyle = getComponentRotatedStyle(component.style);\n        const width = Number(componentStyle.width);\n        const height = Number(componentStyle.height);\n        const top = Number(componentStyle.top);\n        const bottom = Number(componentStyle.bottom);\n        const left = Number(componentStyle.left);\n        const right = Number(componentStyle.right);\n        const componentHalfWidth = width / 2;\n        const componentHalfHeight = height / 2;\n\n        const conditions = {\n          top: [\n            {\n              // 线段名称\n              line: 'xt',\n              // 是否需要吸附\n              isNearly: decideIsNearly(curComponentTop, top),\n              // 吸附的定位\n              dragShift: top,\n              // 吸附线样式\n              lineShift: top\n            },\n            {\n              isNearly: decideIsNearly(curComponentBottom, top),\n              line: 'xt',\n              dragShift: top - curComponentHeight,\n              lineShift: top\n            },\n            {\n              isNearly: decideIsNearly(\n                curComponentTop + curComponentHalfHeight,\n                top + componentHalfHeight\n              ),\n              line: 'xc',\n              dragShift: top + componentHalfHeight - curComponentHalfHeight,\n              lineShift: top + componentHalfHeight\n            },\n            {\n              isNearly: decideIsNearly(curComponentTop, bottom),\n              line: 'xb',\n              dragShift: bottom,\n              lineShift: bottom\n            },\n            {\n              isNearly: decideIsNearly(curComponentBottom, bottom),\n              line: 'xb',\n              dragShift: bottom - curComponentHeight,\n              lineShift: bottom\n            }\n          ],\n          left: [\n            {\n              isNearly: decideIsNearly(curComponentLeft, left),\n              line: 'yl',\n              dragShift: left,\n              lineShift: left\n            },\n            {\n              isNearly: decideIsNearly(curComponentRight, left),\n              line: 'yl',\n              dragShift: left - curComponentWidth,\n              lineShift: left\n            },\n            {\n              isNearly: decideIsNearly(\n                curComponentLeft + curComponentHalfWidth,\n                left + componentHalfWidth\n              ),\n              line: 'yc',\n              dragShift: left + componentHalfWidth - curComponentHalfWidth,\n              lineShift: left + componentHalfWidth\n            },\n            {\n              isNearly: decideIsNearly(curComponentLeft, right),\n              line: 'yr',\n              dragShift: right,\n              lineShift: right\n            },\n            {\n              isNearly: decideIsNearly(curComponentRight, right),\n              line: 'yr',\n              dragShift: right - curComponentWidth,\n              lineShift: right\n            }\n          ]\n        };\n\n        // 生成新的吸附线坐标\n        const newLineStyle = { ...lineStyle };\n        // 生成新的吸附线展示状态\n        const newLineStatus = { ...INIT_LINE_STATUS };\n        forEach(conditions, (condition, key) => {\n          forEach(condition, lineItem => {\n            const { line, isNearly, dragShift, lineShift } = lineItem;\n\n            if (!isNearly) return;\n\n            Object.assign(newLineStatus, { [line]: isNearly });\n            Object.assign(newLineStyle, {\n              [line]: isNearly\n                ? { ...newLineStyle[line as LineMap], [key]: lineShift }\n                : {}\n            });\n\n            componentDispatch({\n              type: 'setCurComponentDragShift',\n              payload: { [key]: dragShift }\n            });\n          });\n        });\n\n        setLineStyle(newLineStyle);\n        onChooseTheTureLine(newLineStatus);\n      });\n    };\n\n    /**\n     * 像外暴露处理吸附线方法\n     */\n    useImperativeHandle(ref, () => ({\n      showLine,\n      hideLine: () => setLineStatus(INIT_LINE_STATUS)\n    }));\n\n    return (\n      <div className={prefixCls}>\n        {map(LINES_MAP, line => (\n          <div\n            key={line}\n            className={`${prefixCls}-line ${\n              includes(line, 'x') ? `${prefixCls}-xline` : `${prefixCls}-yline`\n            }`}\n            style={{\n              display: lineStatus[line] ? 'block' : 'none',\n              ...lineStyle[line]\n            }}\n          />\n        ))}\n      </div>\n    );\n  }\n);\n\nMarkLine.defaultProps = {\n  prefixCls: 'visual-drag-mark'\n};\n\nexport default MarkLine;\n","import './index.less';\n\nimport { forEach, isNil, map, reduce } from 'lodash-es';\nimport React, { FC, useContext, useEffect, useRef, useState } from 'react';\n\nimport Preview from '@/core/Editor/Preview';\nimport {\n  ComponentType,\n  DragEventMethod,\n  MouseEventMethod,\n  MouseEventWithStyleMethod\n} from '@/types';\nimport { $ } from '@/utils';\n\nimport ComponentDataContext from '../context/component-data';\nimport ContextMenuContext from '../context/context-menu';\nimport Area from './Area';\nimport ContextMenu from './ContextMenu';\nimport Grid from './Grid';\nimport MarkLine, { MarkLineRefProps } from './MarkLine';\nimport Shape from './Shape';\n\ninterface EditorProps {\n  prefixCls?: string;\n}\n\nconst Editor: FC<EditorProps> = ({ prefixCls }) => {\n  const { componentState } = useContext(ComponentDataContext);\n  const { menuDispatch } = useContext(ContextMenuContext);\n\n  const [showArea, setShowArea] = useState(false);\n\n  // 吸附线实例\n  const markLineRef = useRef<MarkLineRefProps>(null);\n  // 画布的实例\n  const editorRef = useRef($('#editor'));\n  const editorPosRef = useRef({ editorX: 0, editorY: 0 });\n  const startRef = useRef({ x: 0, y: 0 });\n  const [area, setArea] = useState({ width: 0, height: 0 });\n  const areaRef = useRef({ width: 0, height: 0 });\n\n  const { componentData, canvasStyle } = componentState;\n\n  /**\n   * 右击事件处理器\n   * @param e\n   */\n  const onContextMenu: MouseEventMethod = e => {\n    e.stopPropagation();\n    e.preventDefault();\n\n    let target = e.target;\n    let top = e.nativeEvent.offsetY;\n    let left = e.nativeEvent.offsetX;\n\n    // 右击的 target 是 SVG(背景图) 时候，target = <div class=\"visual-drag-editor\" />\n    while (target instanceof SVGElement) {\n      target = target.parentNode;\n    }\n\n    // 选中自定义组件时候，left、top 需要加上组件的 x,y 坐标\n    while (!target.className.includes('visual-drag-editor')) {\n      left += target.offsetLeft;\n      top += target.offsetTop;\n      target = target.parentNode;\n    }\n\n    menuDispatch({ type: 'show' });\n    menuDispatch({ type: 'setPosition', payload: { left, top } });\n  };\n\n  /**\n   * 显示吸附线并标记坐标\n   * @param e\n   * @param style\n   */\n  const onShapeMove: MouseEventWithStyleMethod = (e, style) => {\n    markLineRef.current?.showLine(style);\n  };\n\n  /**\n   * 隐藏吸附线\n   */\n  const onShapeDestroyMove = () => {\n    markLineRef.current?.hideLine();\n  };\n\n  /**\n   * 获取选中的组件\n   * @return {ComponentType[]}\n   */\n  const getSelectedArea = () => {\n    const { x, y } = startRef.current;\n    const { width: aWidth, height: aHeight } = areaRef.current;\n\n    return reduce(\n      componentData,\n      (result: ComponentType[], component) => {\n        const left = Number(component.style.left);\n        const top = Number(component.style.top);\n        const width = Number(component.style.width);\n        const height = Number(component.style.height);\n        if (\n          x <= left &&\n          y <= top &&\n          left + width <= x + aWidth &&\n          top + height <= y + aHeight\n        ) {\n          result.push(component);\n        }\n        return result;\n      },\n      []\n    );\n  };\n\n  /**\n   * 创建组合区\n   * 1. 利用 getBoundingClientRect() 浏览器 API 获取每个组件相对于浏览器视口四个方向上的信息，也就是 left top right bottom。\n   * 2. 对比每个组件的这四个信息，取得选中区域的最左、最上、最右、最下四个方向的数值，从而得出一个能包含区域内所有组件的最小区域。\n   */\n  const onCreateAreaGroup = () => {\n    const areaComponents = getSelectedArea();\n\n    if (areaComponents.length <= 1) {\n      setShowArea(false);\n      return;\n    }\n\n    const { editorX, editorY } = editorPosRef.current;\n\n    let top = Infinity;\n    let left = Infinity;\n    let right = -Infinity;\n    let bottom = -Infinity;\n\n    forEach(areaComponents, component => {\n      const style: Record<string, number> = {};\n      const rect = $(`#component-${component.id}`)?.getBoundingClientRect();\n      style.left = rect!.left - editorX;\n      style.top = rect!.top - editorY;\n      style.right = rect!.right - editorX;\n      style.bottom = rect!.bottom - editorY;\n\n      if (style.left < left) left = style.left;\n      if (style.top < top) top = style.top;\n      if (style.right > right) right = style.right;\n      if (style.bottom > bottom) bottom = style.bottom;\n    });\n\n    startRef.current = { x: left, y: top };\n    setArea({ width: right - left, height: bottom - top });\n  };\n\n  /**\n   * 编辑器区域内\"鼠标按下\"的事件处理\n   * @param e {DragEvent<HTMLDivElement>}\n   */\n  const onEditorMouseDown: DragEventMethod = e => {\n    // 如果没有选中组件 在画布上点击时需要调用 e.preventDefault() 防止触发 drop 事件\n    e.preventDefault();\n\n    // 初始化的一些操作\n    // ---\n    // 防止上一轮组合影响UI\n    setShowArea(false);\n    setArea({ width: 0, height: 0 });\n\n    // 获取编辑器的信息(基于document)\n    const rect = editorRef.current?.getBoundingClientRect();\n    editorPosRef.current = {\n      editorX: rect!.x,\n      editorY: rect!.y\n    };\n\n    // 当前点位置(基于document)\n    const startX = e.clientX;\n    const startY = e.clientY;\n\n    startRef.current = {\n      x: startX - editorPosRef.current.editorX,\n      y: startY - editorPosRef.current.editorY\n    };\n\n    // 开启选中区域\n    setShowArea(true);\n\n    const move = (moveEvent: any) => {\n      setArea({\n        width: Math.abs(moveEvent.clientX - startX),\n        height: Math.abs(moveEvent.clientY - startY)\n      });\n      if (moveEvent.clientX < startX) {\n        startRef.current.x = moveEvent.clientX - editorPosRef.current.editorX;\n      }\n\n      if (moveEvent.clientY < startY) {\n        startRef.current.y = moveEvent.clientY - editorPosRef.current.editorY;\n      }\n    };\n\n    const up = (e: any) => {\n      document.removeEventListener('mousemove', move);\n      document.removeEventListener('mouseup', up);\n\n      if (e.clientX === startX && e.clientY === startY) {\n        setShowArea(false);\n        setArea({ width: 0, height: 0 });\n        return;\n      }\n\n      onCreateAreaGroup();\n    };\n\n    document.addEventListener('mousemove', move);\n    document.addEventListener('mouseup', up);\n  };\n\n  useEffect(() => {\n    if (isNil(editorRef.current)) {\n      editorRef.current = $('#editor');\n    }\n  }, [editorRef.current]);\n\n  useEffect(() => {\n    areaRef.current = area;\n  }, [area]);\n\n  return (\n    <div\n      className={prefixCls}\n      style={canvasStyle}\n      id=\"editor\"\n      onContextMenu={onContextMenu}\n      onMouseDown={onEditorMouseDown}\n    >\n      <Grid />\n\n      {map(componentData, (component, index) => {\n        return (\n          <Shape\n            key={component.id}\n            index={index}\n            originalComponent={component}\n            onMove={onShapeMove}\n            onDestroyMove={onShapeDestroyMove}\n          />\n        );\n      })}\n\n      <ContextMenu />\n\n      <MarkLine ref={markLineRef} />\n\n      <Preview />\n\n      {showArea && (\n        <Area\n          top={startRef.current.y}\n          left={startRef.current.x}\n          width={area.width}\n          height={area.height}\n        />\n      )}\n    </div>\n  );\n};\n\nEditor.defaultProps = {\n  prefixCls: 'visual-drag-editor'\n};\n\nexport default Editor;\n","const textAlignOptions = [\n  {\n    label: '相左对齐',\n    value: 'left'\n  },\n  {\n    label: '居中对齐',\n    value: 'center'\n  },\n  {\n    label: '相右对齐',\n    value: 'right'\n  }\n];\n\nexport const propertyConfigs = [\n  {\n    name: 'label',\n    label: '内容',\n    componentName: 'input',\n    props: {}\n  },\n  {\n    name: 'opacity',\n    label: '透明度',\n    componentName: 'input',\n    props: {}\n  },\n  {\n    name: 'width',\n    label: '宽度',\n    componentName: 'input',\n    props: {}\n  },\n  {\n    name: 'height',\n    label: '高度',\n    componentName: 'input',\n    props: {}\n  },\n  {\n    name: 'fontSize',\n    label: '字体大小',\n    componentName: 'input',\n    props: {}\n  },\n  {\n    name: 'fontWeight',\n    label: '字体粗细',\n    componentName: 'input',\n    props: {}\n  },\n  {\n    name: 'lineHeight',\n    label: '行间距',\n    componentName: 'input',\n    props: {}\n  },\n  {\n    name: 'letterSpace',\n    label: '字间距',\n    componentName: 'input',\n    props: {}\n  },\n  {\n    name: 'textAlign',\n    label: '对齐方式',\n    componentName: 'select',\n    props: {\n      options: textAlignOptions\n    }\n  }\n];\n","/**\n * 事件处理\n * @Date:   2021-08-08 14:56\n */\nimport { Button, Drawer, Input, message, Tabs } from 'antd';\nimport React, { FC, useContext, useState } from 'react';\nconst { TabPane } = Tabs;\nimport { map } from 'lodash-es';\n\nimport { ComponentTypeEventKey } from '@/types';\nimport { eventList } from '@/utils/events';\n\nimport ComponentDataContext from '../context/component-data';\n\nconst Event: FC = () => {\n  const { componentDispatch, componentState } =\n    useContext(ComponentDataContext);\n  const { curComponentId } = componentState;\n  const [visible, setVisible] = useState(false);\n  const [value, setValue] = useState('');\n  const [tab, setTab] = useState<ComponentTypeEventKey>('message');\n\n  return (\n    <div>\n      {curComponentId > -1 && (\n        <Button type=\"primary\" onClick={() => setVisible(true)}>\n          添加事件\n        </Button>\n      )}\n\n      <Drawer\n        width={320}\n        placement=\"right\"\n        closable={false}\n        onClose={() => setVisible(false)}\n        visible={visible}\n      >\n        <Tabs\n          activeKey={tab}\n          onChange={activeKey => setTab(activeKey as ComponentTypeEventKey)}\n        >\n          {map(eventList, eventItem => (\n            <TabPane tab={eventItem.label} key={eventItem.key}>\n              <Input.TextArea\n                value={value}\n                onChange={e => setValue(e.target.value)}\n              />\n            </TabPane>\n          ))}\n        </Tabs>\n\n        <Button\n          style={{ marginTop: 24 }}\n          onClick={() => {\n            componentDispatch({\n              type: 'createEvents',\n              payload: {\n                key: tab,\n                value\n              }\n            });\n            setValue('');\n            message.success('事件添加成功');\n            setVisible(false);\n          }}\n        >\n          确认\n        </Button>\n      </Drawer>\n    </div>\n  );\n};\n\nexport default Event;\n","import { Card, Form, Input, Select, Tabs } from 'antd';\nimport { FormProps } from 'antd/es/form';\nimport { debounce, find, join, map, omit } from 'lodash-es';\nimport React, { FC, useContext, useEffect, useRef, useState } from 'react';\n\nimport { TObj } from '@/types';\n\nimport ComponentDataContext from '../context/component-data';\nimport { propertyConfigs } from './data';\nimport Event from './Event';\nconst { Item: FormItem } = Form;\nconst { TabPane } = Tabs;\n\ninterface PropertyProps {\n  prefixCls?: string;\n}\n\nconst initialValues = {\n  opacity: undefined,\n  width: undefined,\n  height: undefined,\n  fontSize: undefined,\n  fontWeight: undefined,\n  lineHeight: undefined,\n  letterSpace: undefined,\n  textAlign: undefined,\n  label: undefined\n};\n\nconst propFields = ['label'];\n\n/**\n * 渲染不同类型的组件\n * @return {ReactNode}\n */\nconst renderFormItem = map(propertyConfigs, config => {\n  const { componentName, props, ...restProps } = config;\n  let component;\n  switch (componentName) {\n    case 'select':\n      component = <Select {...props} />;\n      break;\n    default:\n      component = <Input {...props} />;\n  }\n  return (\n    <FormItem key={restProps.name} {...restProps}>\n      {component}\n    </FormItem>\n  );\n});\n\nconst Property: FC<PropertyProps> = ({ prefixCls }) => {\n  const { componentState, curComponentIndex, componentDispatch } =\n    useContext(ComponentDataContext);\n  const { curComponentId, componentData, snapshots } = componentState;\n  const [initial, setInitial] = useState<Record<string, any>>(initialValues);\n  const [form] = Form.useForm();\n  const firstRenderRef = useRef(true);\n\n  const reset = debounce(form.resetFields, 100);\n\n  /**\n   * 改变组件的属性值\n   */\n  const setComponentContext = debounce(config => {\n    componentDispatch({\n      type: 'setComponentProps',\n      payload: { index: curComponentIndex, config }\n    });\n  }, 1000);\n\n  /**\n   * 表单值处理\n   * @param changedValues\n   * @param values\n   */\n  const onValuesChange: FormProps['onValuesChange'] = (\n    changedValues,\n    values\n  ) => {\n    const { label } = values;\n    const curStyle = omit(values, propFields);\n    if (curComponentIndex > -1) {\n      const style = { ...componentData[curComponentIndex].style, ...curStyle };\n      setComponentContext({ label, style });\n    }\n  };\n\n  useEffect(() => {\n    let curComponentStyle: TObj = initialValues;\n    if (curComponentId > -1) {\n      const curComponent = find(componentData, ['id', curComponentId]);\n\n      if (curComponent)\n        curComponentStyle = {\n          ...curComponent.style,\n          label: curComponent.label\n        };\n    }\n    setInitial(curComponentStyle);\n  }, [curComponentId, componentData]);\n\n  useEffect(() => {\n    if (firstRenderRef.current) {\n      firstRenderRef.current = false;\n      return;\n    }\n    reset();\n  }, [initial]);\n\n  return (\n    <div className={prefixCls}>\n      <Tabs defaultActiveKey=\"property\">\n        <TabPane forceRender tab=\"属性\" key=\"property\">\n          {curComponentId > -1 ? (\n            <Form\n              colon={false}\n              form={form}\n              labelCol={{ span: 4 }}\n              initialValues={initial}\n              onValuesChange={onValuesChange}\n            >\n              {renderFormItem}\n            </Form>\n          ) : (\n            '请选择组件'\n          )}\n        </TabPane>\n        <TabPane tab=\"快照\" key=\"animation\">\n          {map(snapshots, (snapshot, index) => {\n            const names = join(map(snapshot, 'id'), ',');\n            return (\n              <Card key={`${index}`} title={`第 ${index + 1} 步`}>\n                ids: {names}\n              </Card>\n            );\n          })}\n        </TabPane>\n        <TabPane tab=\"事件\" key=\"event\">\n          <Event />\n        </TabPane>\n      </Tabs>\n    </div>\n  );\n};\n\nProperty.defaultProps = {\n  prefixCls: 'visual-drag-property'\n};\n\nexport default Property;\n","import { message } from 'antd';\nimport { cloneDeep, findIndex, includes } from 'lodash-es';\nimport { CSSProperties } from 'react';\n\nimport { ComponentType } from '@/types';\nimport { generateID } from '@/utils';\n\n/**\n * 保存组件数据源\n * 改变组件样式\n * 删除组件\n * 设置当前组件\n * 设置 active 状态\n * 撤销\n * 重做\n * 复制\n * 黏贴\n * 置顶\n * 置底\n * 上移\n * 下移\n * 保存快照\n * 修改当前组件位移\n * 预览状态\n * 添加事件\n * 移除事件\n * 设置画布样式\n * */\nexport type ComponentDataReducerActionType =\n  | 'setComponentData'\n  | 'setComponentProps'\n  | 'setComponentStyle'\n  | 'destroyComponent'\n  | 'setCurComponent'\n  | 'setClick'\n  | 'undo'\n  | 'redo'\n  | 'copy'\n  | 'paste'\n  | 'top'\n  | 'bottom'\n  | 'up'\n  | 'down'\n  | 'recordSnapshot'\n  | 'setCurComponentDragShift'\n  | 'setPreview'\n  | 'createEvents'\n  | 'removeEvents'\n  | 'setCanvasStyle';\n\nexport interface ComponentDataReducerAction {\n  type: ComponentDataReducerActionType;\n  payload?: any;\n}\n\nexport interface ComponentDataReducerState {\n  /** 数据源 */\n  componentData: ComponentType[];\n  /** 当前组件索引 */\n  curComponentId: number;\n  /** 是否是 active 组件 */\n  isClickComponent: boolean;\n  /** 预览模式状态 */\n  preview: boolean;\n  /** 快照保存 */\n  snapshots: ComponentType[][];\n  /** 当前属于哪级快照的索引 */\n  snapshotIndex: number;\n  /** 当前需要组件需要操作的样式 */\n  dragShiftStyle: CSSProperties;\n  /** 画布的样式 默认只有宽高 */\n  canvasStyle: Record<string, number>;\n  /** 复制的数据 */\n  copyData?: ComponentType;\n}\n\nconst needIndexTypes = [\n  'destroyComponent',\n  'createEvents',\n  'removeEvents',\n  'bottom',\n  'copy',\n  'down',\n  'top',\n  'up'\n];\n\n/**\n * 替换下组件位置 up down top bottom 等操作\n * @param sourceComponents\n * @param source\n * @param target\n */\nconst replaceComponentsLocation = (\n  sourceComponents: ComponentType[],\n  source: number,\n  target: number\n) => {\n  const components: ComponentType[] = [...sourceComponents];\n  [components[source], components[target]] = [\n    components[target],\n    components[source]\n  ];\n  return components;\n};\n\nexport default function reducer(\n  state: ComponentDataReducerState,\n  action: ComponentDataReducerAction\n) {\n  const { type, payload } = action;\n  let curComponentIndex = -1;\n\n  if (includes(needIndexTypes, type)) {\n    curComponentIndex = findIndex(state.componentData, [\n      'id',\n      state.curComponentId\n    ]);\n  }\n\n  switch (type) {\n    case 'setComponentData': {\n      return { ...state, componentData: payload };\n    }\n    case 'setComponentProps': {\n      const { config, index } = payload;\n      const componentData = cloneDeep(state.componentData);\n      Object.assign(componentData[index], { ...config });\n      return { ...state, componentData };\n    }\n    case 'setComponentStyle': {\n      const { style, index } = payload;\n      const newState = cloneDeep(state);\n      Object.assign(newState.componentData[index], { style });\n      return newState;\n    }\n    case 'destroyComponent': {\n      const newComponents = [...state.componentData];\n      let curIndex = payload;\n      if (curIndex === undefined) {\n        curIndex = curComponentIndex;\n      }\n      if (curIndex > -1) {\n        newComponents.splice(curIndex, 1);\n      }\n      return { ...state, componentData: newComponents };\n    }\n    case 'setCurComponent':\n      return {\n        ...state,\n        curComponentId: payload.id\n      };\n    case 'setCurComponentDragShift':\n      return {\n        ...state,\n        dragShiftStyle: payload\n      };\n    case 'setClick':\n      return { ...state, isClickComponent: payload };\n    case 'undo': {\n      const newState = { ...state };\n      // 撤销回最开始时候是原始值 []\n      newState.componentData =\n        newState.snapshots[--newState.snapshotIndex] || [];\n      return newState;\n    }\n    case 'redo':\n      if (state.snapshotIndex < state.snapshots.length - 1) {\n        const newSnapshotIndex = state.snapshotIndex + 1;\n        return {\n          ...state,\n          snapshotIndex: newSnapshotIndex,\n          componentData: state.snapshots[newSnapshotIndex]\n        };\n      }\n      return state;\n    case 'copy':\n      return { ...state, copyData: state.componentData[curComponentIndex] };\n    case 'paste': {\n      const data = cloneDeep(state.copyData);\n      if (!data) {\n        message.error('请选择组件');\n        return state;\n      }\n      Object.assign(data, {\n        style: { ...data.style, ...payload },\n        id: generateID()\n      });\n      return { ...state, componentData: [...state.componentData, data] };\n    }\n    case 'top': {\n      const newComponents = [...state.componentData];\n      // 容错处理\n      if (newComponents.length < 2) {\n        return state;\n      }\n      return {\n        ...state,\n        componentData: replaceComponentsLocation(\n          newComponents,\n          curComponentIndex,\n          newComponents.length - 1\n        )\n      };\n    }\n    case 'bottom': {\n      const newComponents = [...state.componentData];\n      // 容错处理\n      if (newComponents.length < 2) {\n        return state;\n      }\n      return {\n        ...state,\n        componentData: replaceComponentsLocation(\n          newComponents,\n          curComponentIndex,\n          0\n        )\n      };\n    }\n    case 'up': {\n      const newComponents = [...state.componentData];\n      // 容错处理\n      if (\n        newComponents.length < 2 ||\n        curComponentIndex === newComponents.length - 1\n      ) {\n        return state;\n      }\n      return {\n        ...state,\n        componentData: replaceComponentsLocation(\n          newComponents,\n          curComponentIndex,\n          curComponentIndex + 1\n        )\n      };\n    }\n    case 'down': {\n      const newComponents = [...state.componentData];\n      // 容错处理\n      if (newComponents.length < 2 || curComponentIndex === 0) {\n        return state;\n      }\n      return {\n        ...state,\n        componentData: replaceComponentsLocation(\n          newComponents,\n          curComponentIndex,\n          curComponentIndex - 1\n        )\n      };\n    }\n    case 'recordSnapshot': {\n      const newState = { ...state };\n      newState.snapshots[++newState.snapshotIndex] = payload\n        ?.snapshots?.[0] as ComponentType[];\n\n      // 在 undo 过程中，添加新的快照时，要将它后面的快照清理掉\n      if (newState.snapshotIndex < newState.snapshots.length - 1) {\n        newState.snapshots = newState.snapshots.slice(\n          0,\n          newState.snapshotIndex + 1\n        );\n      }\n      return newState;\n    }\n    case 'setPreview':\n      return { ...state, preview: payload };\n    case 'createEvents': {\n      const componentData = cloneDeep(state.componentData);\n      const curComponent = componentData[curComponentIndex];\n      curComponent.events = curComponent.events || [];\n      const replaceEventIndex = findIndex(curComponent.events, [\n        'key',\n        payload.key\n      ]);\n      if (replaceEventIndex > -1) {\n        curComponent.events.splice(replaceEventIndex, 1, payload);\n      } else {\n        curComponent.events.push(payload);\n      }\n      return { ...state, componentData };\n    }\n    case 'removeEvents':\n      return { ...state, preview: payload };\n    case 'setCanvasStyle':\n      return { ...state, canvasStyle: { ...state.canvasStyle, ...payload } };\n    default:\n      throw new Error();\n  }\n}\n","import { ContextMenuPosition } from '@/types';\n\n/**\n * 显示\n * 隐藏\n * 设置位置\n */\nexport type ComponentDataReducerActionType = 'hide' | 'show' | 'setPosition';\n\nexport interface ComponentDataReducerAction {\n  type: ComponentDataReducerActionType;\n  payload?: any;\n}\n\nexport interface ContextMenuReducerState {\n  visible: boolean;\n  position: ContextMenuPosition;\n}\n\nexport default function reducer(\n  state: ContextMenuReducerState,\n  action: ComponentDataReducerAction\n) {\n  const { type, payload } = action;\n\n  switch (type) {\n    case 'show':\n      return { ...state, visible: true };\n    case 'hide':\n      return { ...state, visible: false };\n    case 'setPosition':\n      return { ...state, position: payload };\n  }\n}\n","import './style/index.less';\n\nimport { Button, InputNumber, Space } from 'antd';\nimport React, { FC, useContext } from 'react';\n\nimport ComponentDataContext from '../core/context/component-data';\n\ninterface ToolbarProps {\n  prefixCls?: string;\n  onReload?: () => void;\n}\n\nconst Toolbar: FC<ToolbarProps> = ({\n  prefixCls = 'visual-drag-header',\n  onReload\n}) => {\n  const { componentDispatch, componentState } =\n    useContext(ComponentDataContext);\n  const { componentData } = componentState;\n\n  /**\n   * 保存快照\n   */\n  const onSave = () => {\n    componentDispatch({\n      type: 'recordSnapshot',\n      payload: {\n        snapshots: [componentData]\n      }\n    });\n  };\n\n  /**\n   * 重做事件处理器\n   */\n  const onRestart = () => {\n    onReload?.();\n    componentDispatch({\n      type: 'redo'\n    });\n  };\n\n  /**\n   * 撤销事件处理器\n   */\n  const onUndo = () => {\n    componentDispatch({ type: 'undo' });\n  };\n\n  /**\n   * 打开预览模式\n   */\n  const onPreview = () =>\n    componentDispatch({ type: 'setPreview', payload: true });\n\n  /**\n   * 改变画布大小事件处理器\n   * @param key\n   * @param value\n   */\n  const onCanvasStyleChange = (key: string, value: number) =>\n    componentDispatch({ type: 'setCanvasStyle', payload: { [key]: value } });\n\n  return (\n    <header className={prefixCls}>\n      <Space size={12}>\n        <Button size=\"small\" onClick={onUndo}>\n          撤销\n        </Button>\n        <Button size=\"small\" onClick={onRestart}>\n          重做\n        </Button>\n        <Button size=\"small\" onClick={onPreview}>\n          预览\n        </Button>\n        <Button size=\"small\" onClick={onSave}>\n          保存\n        </Button>\n\n        <Space>\n          画布大小\n          <InputNumber\n            size=\"small\"\n            min={1}\n            max={1200}\n            defaultValue={1200}\n            onChange={value => onCanvasStyleChange('width', value)}\n          />\n          *\n          <InputNumber\n            size=\"small\"\n            min={1}\n            max={760}\n            defaultValue={760}\n            onChange={value => onCanvasStyleChange('height', value)}\n          />\n        </Space>\n      </Space>\n    </header>\n  );\n};\n\nexport default Toolbar;\n","import './index.less';\n\nimport { cloneDeep, findIndex } from 'lodash-es';\nimport React, { FC, useMemo, useReducer } from 'react';\n\nimport { COMPONENT_LIST } from '@/core/data';\nimport { DragEventMethod } from '@/types';\nimport { generateID } from '@/utils';\n\nimport BaseComponents from '../core/BaseComponents';\nimport ComponentDataContext from '../core/context/component-data';\nimport ContextMenuContext from '../core/context/context-menu';\nimport Editor from '../core/Editor';\nimport Property from '../core/Property';\nimport componentReducer from '../core/reducer/component-data';\nimport contextReducer from '../core/reducer/context-menu';\nimport Toolbar from '../core/Toolbar';\n\ninterface HomeProps {\n  prefixCls?: string;\n}\n\nconst Demo: FC<HomeProps> = ({ prefixCls }) => {\n  const [componentState, componentDispatch] = useReducer(componentReducer, {\n    isClickComponent: false,\n    preview: false,\n    snapshotIndex: -1,\n    curComponentId: -1,\n    snapshots: [],\n    dragShiftStyle: {},\n    canvasStyle: { width: 1200, height: 760 },\n    componentData: [\n      {\n        id: 0,\n        name: 'r-button',\n        label: '按钮',\n        props: {},\n        style: {\n          width: 100,\n          height: 32,\n          borderWidth: 1,\n          borderColor: '',\n          borderRadius: '',\n          fontSize: 14,\n          fontWeight: 500,\n          lineHeight: '',\n          letterSpacing: 0,\n          textAlign: '',\n          color: '',\n          backgroundColor: '',\n          rotate: 0,\n          opacity: 1,\n          top: 86,\n          left: 117\n        }\n      }\n    ]\n  });\n  const [menuState, menuDispatch] = useReducer(contextReducer, {\n    visible: false,\n    position: { left: 0, top: 0 }\n  });\n  const { componentData, isClickComponent, curComponentId, canvasStyle } =\n    componentState;\n\n  // active 组件的索引\n  const curComponentIndex = useMemo(\n    () => findIndex(componentData, ['id', curComponentId]),\n    [componentData, curComponentId]\n  );\n\n  /**\n   * 组件模板拖拽到画布的事件(添加组件)\n   * @param e {DragEvent<HTMLDivElement>}\n   */\n  const onDrop: DragEventMethod = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    const component = cloneDeep(\n      COMPONENT_LIST[Number(e.dataTransfer.getData('index'))]\n    );\n    component.style.top = e.nativeEvent.offsetY;\n    component.style.left = e.nativeEvent.offsetX;\n    component.id = generateID();\n    componentDispatch({\n      type: 'setComponentData',\n      payload: [...componentData, component]\n    });\n  };\n\n  /**\n   * 基础组件拖动到画布中的事件(ps: 不可使用 onDragEnter)\n   * @param e {DragEvent<HTMLDivElement>}\n   */\n  const onDragOver: DragEventMethod = e => {\n    // 允许放置的条件\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'copy';\n  };\n\n  /**\n   * 鼠标抬起事件\n   * @param e\n   */\n  const onMouseUp: DragEventMethod = e => {\n    if (!isClickComponent) {\n      // FIXME 需要先执行右键操作再取消选择组件 被迫来个异步操作\n      setTimeout(() => {\n        componentDispatch({\n          type: 'setCurComponent',\n          payload: { id: -1 }\n        });\n      }, 0);\n    }\n    // 右击操作\n    if (e.button !== 2) {\n      menuDispatch({ type: 'hide' });\n    }\n  };\n\n  return (\n    <div className={prefixCls}>\n      <ComponentDataContext.Provider\n        value={{\n          curComponentIndex,\n          componentState,\n          componentDispatch\n        }}\n      >\n        <ContextMenuContext.Provider value={{ menuState, menuDispatch }}>\n          <Toolbar />\n          <div className={`${prefixCls}-content`}>\n            <div className={`${prefixCls}-content-left`}>\n              <BaseComponents />\n            </div>\n            <div className={`${prefixCls}-content-wrapper`} style={canvasStyle}>\n              <div\n                className={`${prefixCls}-content-wrapper-canvas`}\n                onDrop={onDrop}\n                onDragOver={onDragOver}\n                onMouseUp={onMouseUp}\n                onMouseDown={() =>\n                  componentDispatch({ type: 'setClick', payload: false })\n                }\n              >\n                <Editor />\n              </div>\n            </div>\n            <div className={`${prefixCls}-content-show`}>\n              <Property />\n            </div>\n          </div>\n        </ContextMenuContext.Provider>\n      </ComponentDataContext.Provider>\n    </div>\n  );\n};\n\nDemo.defaultProps = {\n  prefixCls: 'home'\n};\n\nexport default Demo;\n","import './App.less';\n\nimport React from 'react';\n\nimport Home from './Home';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Home />\n    </div>\n  );\n}\n\nexport default App;\n","import './index.css';\n\nimport { ConfigProvider } from 'antd';\nimport zhCN from 'antd/lib/locale/zh_CN';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <ConfigProvider locale={zhCN}>\n      <App />\n    </ConfigProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}